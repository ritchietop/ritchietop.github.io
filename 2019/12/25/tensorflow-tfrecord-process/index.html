<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="python, scala, spark, hive, hbase, hadoop, tensorflow, flink, 机器学习, 深度学习, 算法"><title>【tensorflow】TFRecord数据读写 | Ritchie's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '87868a9c378cabc27812ae2d1ebfbb13';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【tensorflow】TFRecord数据读写</h1><a id="logo" href="/.">Ritchie's Blog</a><p class="description">点滴记录，技术提升进程</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-list"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于我</i></a><a href="/timeline/"><i class="fa fa-history"> 大事记</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【tensorflow】TFRecord数据读写</h1><div class="post-meta">Dec 25, 2019<span> | </span><span class="category"><a href="/categories/tensorflow/">tensorflow</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">1.</span> <span class="toc-text">样例数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">2.</span> <span class="toc-text">Schema定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">3.</span> <span class="toc-text">TFRecord数据读写（java/scala版）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">3.1.</span> <span class="toc-text">使用tensorflow-utils组装TFRecord数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">3.2.</span> <span class="toc-text">使用Spark快速读写TFRecord数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">4.</span> <span class="toc-text">TFRecord数据读写（python版）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">4.1.</span> <span class="toc-text">TFRecord写入样例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">4.2.</span> <span class="toc-text">TFRecord解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">4.2.1.</span> <span class="toc-text">Example解析API</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><p>TFRecord&#x683C;&#x5F0F;&#x662F;&#x5B98;&#x65B9;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7684;&#x6A21;&#x578B;&#x8F93;&#x5165;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x3002;&#x6A21;&#x578B;&#x5728;&#x8BAD;&#x7EC3;&#x548C;&#x9884;&#x6D4B;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;TFRecord&#x683C;&#x5F0F;&#x7528;&#x4E8E;&#x7EC4;&#x7EC7;&#x6A21;&#x578B;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;TFRecord&#x6765;&#x5B58;&#x50A8;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x4E5F;&#x4F7F;&#x7528;TFRecord&#x7684;&#x6570;&#x636E;&#x4F5C;&#x4E3A;&#x6A21;&#x578B;&#x8BA1;&#x7B97;&#x7684;&#x8F93;&#x5165;&#x3002;</p>
<p>TFRecord&#x7684;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#xFF0C;&#x80FD;&#x591F;&#x4EE5;&#x8F83;&#x5C0F;&#x7684;&#x7A7A;&#x95F4;&#x6765;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x643A;&#x5E26;&#x3002;&#x5BF9;&#x4E8E;&#x57FA;&#x4E8E;Tensorflow Serving&#x8FD9;&#x79CD;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x8F93;&#x5165;&#x6570;&#x636E;&#x7684;&#x6253;&#x5206;&#x5F62;&#x5F0F;&#xFF0C;&#x8F83;&#x5C0F;&#x7684;&#x4F20;&#x8F93;&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x6253;&#x5206;&#x6027;&#x80FD;&#x7684;&#x63D0;&#x5347;&#x662F;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#x7684;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x4F7F;&#x7528;TFRecord&#x5C31;&#x5BF9;&#x4E86;&#xFF01;</p>
<a id="more"></a>
<h2>&#x6837;&#x4F8B;&#x6570;&#x636E;</h2>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">valueA1</span>,2<span class="selector-class">.3</span>,<span class="selector-tag">valueC3</span><span class="selector-pseudo">:valueC2</span><span class="selector-pseudo">:valueC8</span>,3<span class="selector-pseudo">:4</span>,<span class="selector-tag">valueE3</span><span class="selector-pseudo">:valueE8</span><span class="selector-pseudo">:valueE3</span><span class="selector-pseudo">:valueE9</span>,4<span class="selector-class">.5</span><span class="selector-pseudo">:1.2</span><span class="selector-pseudo">:2.1</span>,<span class="selector-tag">valueG5</span><span class="selector-pseudo">:valueG9</span><span class="selector-id">#valueG3</span><span class="selector-pseudo">:valueG1</span><span class="selector-id">#valueG5</span><span class="selector-pseudo">:valueG3</span>,4<span class="selector-pseudo">:5</span><span class="selector-pseudo">:2</span><span class="selector-id">#1</span><span class="selector-pseudo">:2</span><span class="selector-pseudo">:3</span>,3<span class="selector-pseudo">:20</span><span class="selector-pseudo">:5</span><span class="selector-pseudo">:3</span>,1<span class="selector-pseudo">:0</span><span class="selector-pseudo">:2</span><span class="selector-pseudo">:2</span>,4<span class="selector-pseudo">:2</span><span class="selector-pseudo">:8</span><span class="selector-pseudo">:9</span>,<span class="selector-tag">valueI6</span><span class="selector-pseudo">:valueI9</span><span class="selector-pseudo">:valueI3</span><span class="selector-pseudo">:valueI6</span></span><br><span class="line"><span class="selector-tag">valueA2</span>,4<span class="selector-class">.1</span>,<span class="selector-tag">valueC1</span><span class="selector-pseudo">:valueC2</span><span class="selector-pseudo">:valueC3</span>,,<span class="selector-tag">valueE6</span><span class="selector-pseudo">:valueE1</span>,9<span class="selector-class">.4</span><span class="selector-pseudo">:6.6</span><span class="selector-pseudo">:8.3</span><span class="selector-pseudo">:7.2</span><span class="selector-pseudo">:9.1</span>,<span class="selector-tag">valueG2</span><span class="selector-pseudo">:valueG1</span><span class="selector-id">#valueG6</span><span class="selector-pseudo">:valueG6</span>,1<span class="selector-pseudo">:1</span><span class="selector-pseudo">:3</span><span class="selector-id">#4</span><span class="selector-pseudo">:2</span><span class="selector-pseudo">:9</span><span class="selector-id">#8</span><span class="selector-pseudo">:4</span><span class="selector-pseudo">:2</span>,5<span class="selector-pseudo">:10</span><span class="selector-pseudo">:2</span><span class="selector-pseudo">:2</span><span class="selector-pseudo">:6</span>,4<span class="selector-pseudo">:2</span><span class="selector-pseudo">:7</span><span class="selector-pseudo">:6</span><span class="selector-pseudo">:3</span>,3<span class="selector-pseudo">:1</span><span class="selector-pseudo">:8</span><span class="selector-pseudo">:4</span><span class="selector-pseudo">:2</span>,<span class="selector-tag">valueI3</span><span class="selector-pseudo">:valueI5</span><span class="selector-pseudo">:valueI2</span><span class="selector-pseudo">:valueI7</span><span class="selector-pseudo">:valueI5</span></span><br><span class="line"><span class="selector-tag">valueA1</span>,3<span class="selector-class">.7</span>,<span class="selector-tag">valueC5</span><span class="selector-pseudo">:valueC5</span><span class="selector-pseudo">:valueC5</span>,2<span class="selector-pseudo">:5</span>,<span class="selector-tag">valueE3</span><span class="selector-pseudo">:valueE3</span><span class="selector-pseudo">:valueE3</span>,5<span class="selector-class">.3</span>,,7<span class="selector-pseudo">:3</span><span class="selector-pseudo">:2</span><span class="selector-id">#6</span><span class="selector-pseudo">:4</span><span class="selector-pseudo">:6</span><span class="selector-id">#3</span><span class="selector-pseudo">:1</span><span class="selector-pseudo">:1</span><span class="selector-id">#8</span><span class="selector-pseudo">:9</span><span class="selector-pseudo">:8</span>,6<span class="selector-pseudo">:10</span>,2<span class="selector-pseudo">:7</span>,1<span class="selector-pseudo">:4</span>,<span class="selector-tag">valueI5</span><span class="selector-pseudo">:valueI5</span></span><br></pre></td></tr></table></figure>
<p>&#x9017;&#x53F7;&#xFF08;,&#xFF09;&#x5206;&#x5272;&#x4E86;&#x6BCF;&#x4E2A;&#x7279;&#x5F81;&#x5217;&#x3002;&#x4E95;&#x53F7;&#xFF08;#&#xFF09;&#x5206;&#x5272;&#x4E86;&#x6BCF;&#x4E2A;&#x7279;&#x5F81;&#x5185;&#x7684;&#x591A;&#x4E2A;&#x53D6;&#x503C;&#x3002;&#x5192;&#x53F7;&#xFF08;:&#xFF09;&#x5206;&#x5272;&#x4E86;&#x6BCF;&#x4E2A;&#x53D6;&#x503C;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x3002;<br>
&#x8FD9;&#x91CC;&#x5B9A;&#x4E49;&#x7279;&#x5F81;&#x5217;&#x7684;&#x540D;&#x79F0;&#x4E3A;&#xFF1A;<br>
[&#x201C;featureA&#x201D;, &#x201C;featureB&#x201D;, &#x201C;featureC&#x201D;, &#x201C;featureD&#x201D;, &#x201C;featureE&#x201D;, &#x201C;featureF&#x201D;, &#x201C;featureG&#x201D;,<br>
&#x201C;featureH&#x201D;, &#x201C;featureI_Index0&#x201D;, &#x201C;featureI_Index1&#x201D;, &#x201C;featureI_Index2&#x201D;, &#x201C;featureI_value&#x201D;]</p>
<h2>Schema&#x5B9A;&#x4E49;</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">column_schema = {</span><br><span class="line">    <span class="comment"># featureA: &#x4E00;&#x7EF4;&#x5B57;&#x7B26;&#x4E32;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureA&quot;</span>: tf.io.FixedLenFeature(shape=(<span class="number">1</span>,), dtype=tf.string, default_value=<span class="string">&quot;null&quot;</span>),</span><br><span class="line">    <span class="comment"># featureB: &#x4E00;&#x7EF4;&#x6570;&#x503C;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureB&quot;</span>: tf.io.FixedLenFeature(shape=(<span class="number">1</span>,), dtype=tf.float32, default_value=<span class="number">0.0</span>),</span><br><span class="line">    <span class="comment"># featureC: &#x4E09;&#x7EF4;&#x5B57;&#x7B26;&#x4E32;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureC&quot;</span>: tf.io.FixedLenFeature(shape=(<span class="number">3</span>,), dtype=tf.string, default_value=[<span class="string">&quot;null&quot;</span>, <span class="string">&quot;null&quot;</span>, <span class="string">&quot;null&quot;</span>]),</span><br><span class="line">    <span class="comment"># featureD: &#x4E8C;&#x7EF4;&#x6570;&#x503C;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureD&quot;</span>: tf.io.FixedLenFeature(shape=(<span class="number">2</span>,), dtype=tf.int64, default_value=[<span class="number">0</span>, <span class="number">0</span>]),</span><br><span class="line">    <span class="comment"># featureE: &#x4E0D;&#x56FA;&#x5B9A;&#x7EF4;&#x5EA6;&#x5B57;&#x7B26;&#x4E32;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureE&quot;</span>: tf.io.VarLenFeature(dtype=tf.string),</span><br><span class="line">    <span class="comment"># featureF: &#x4E0D;&#x56FA;&#x5B9A;&#x7EF4;&#x5EA6;&#x6570;&#x503C;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureF&quot;</span>: tf.io.VarLenFeature(dtype=tf.float32),</span><br><span class="line">    <span class="comment"># featureG: &#x4E8C;&#x7EF4;&#x5B57;&#x7B26;&#x4E32;&#x5E8F;&#x5217;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureG&quot;</span>: tf.io.FixedLenSequenceFeature(shape=(<span class="number">2</span>,), dtype=tf.string, allow_missing=<span class="literal">True</span>, default_value=<span class="literal">None</span>),</span><br><span class="line">    <span class="comment"># featureH: &#x4E09;&#x7EF4;&#x6570;&#x503C;&#x5E8F;&#x5217;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureH&quot;</span>: tf.io.FixedLenSequenceFeature(shape=(<span class="number">3</span>,), dtype=tf.int64, allow_missing=<span class="literal">True</span>, default_value=<span class="literal">None</span>),</span><br><span class="line">    <span class="comment"># featureI: 21 * 4 * 10 &#x7EF4;&#x5B57;&#x7B26;&#x4E32;&#x7A00;&#x758F;&#x7279;&#x5F81;</span></span><br><span class="line">    <span class="string">&quot;featureI&quot;</span>: tf.io.SparseFeature(index_key=[<span class="string">&quot;featureI_Index0&quot;</span>, <span class="string">&quot;featureI_Index1&quot;</span>, <span class="string">&quot;featureI_Index2&quot;</span>],</span><br><span class="line">                                    value_key=<span class="string">&quot;featureI_value&quot;</span>, dtype=tf.string, size=[<span class="number">21</span>, <span class="number">4</span>, <span class="number">10</span>], already_sorted=<span class="literal">False</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<blockquote>
<p>tf.io.FixedLenFeature</p>
</blockquote>
<p>&#x7528;&#x4E8E;&#x89E3;&#x6790;shape&#x548C;&#x7C7B;&#x578B;&#x786E;&#x5B9A;&#x7684;&#x7279;&#x5F81;&#x5217;&#x3002;&#x5728;&#x7279;&#x5F81;&#x5217;&#x7F3A;&#x5931;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;default_value&#x4E0D;&#x8BBE;&#x7F6E;&#x4F1A;&#x5F15;&#x53D1;&#x9519;&#x8BEF;&#x3002;default_value&#x7684;&#x503C;&#x9700;&#x8981;&#x548C;&#x8BBE;&#x7F6E;&#x7684;shape&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</p>
<blockquote>
<p>tf.io.VarLenFeature</p>
</blockquote>
<p>&#x7528;&#x4E8E;&#x89E3;&#x6790;&#x7C7B;&#x578B;&#x786E;&#x5B9A;&#xFF0C;&#x4F46;&#x662F;shape&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#x7279;&#x5F81;&#x5217;&#x3002;</p>
<blockquote>
<p>tf.io.FixedLenSequenceFeature</p>
</blockquote>
<p>&#x7528;&#x4E8E;&#x89E3;&#x6790;shape&#x548C;&#x7C7B;&#x578B;&#x786E;&#x5B9A;&#x7684;&#x5E8F;&#x5217;&#x7279;&#x5F81;&#x5217;&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x5E8F;&#x5217;&#x7279;&#x5F81;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;[(1,2), (3,4), (5,6)]&#x3002;&#x5217;&#x8868;&#x7684;&#x957F;&#x5EA6;&#x4E0D;&#x56FA;&#x5B9A;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x7684;shape&#x56FA;&#x5B9A;&#x3002;</p>
<p>allow_missing=True&#x5141;&#x8BB8;&#x7279;&#x5F81;&#x503C;&#x4E0D;&#x5B58;&#x5728;&#x3002;&#x901A;&#x8FC7;default_value&#x6765;&#x6307;&#x5B9A;&#x586B;&#x5145;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</p>
<p>tf.io.parse_sequence_example&#x65B9;&#x6CD5;&#x8C8C;&#x4F3C;&#x8981;&#x6C42;default_value&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E3A;None</p>
<blockquote>
<p>tf.io.SparseFeature</p>
</blockquote>
<p>&#x7528;&#x4E8E;&#x89E3;&#x6790;&#x901A;&#x8FC7;&#x7A00;&#x758F;&#x77E9;&#x9635;&#x7684;&#x683C;&#x5F0F;&#x6765;&#x5B58;&#x50A8;&#x7684;&#x7279;&#x5F81;&#xFF0C;&#x5305;&#x62EC;index_key&#x548C;value_key&#x4E24;&#x90E8;&#x5206;&#x3002;&#x51E1;&#x662F;&#x7528;&#x5230;SparseFeature&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x90FD;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;VarLenFeature&#x6765;&#x66FF;&#x4EE3;&#x3002;</p>
<h2>TFRecord&#x6570;&#x636E;&#x8BFB;&#x5199;&#xFF08;java/scala&#x7248;&#xFF09;</h2>
<h3>&#x4F7F;&#x7528;tensorflow-utils&#x7EC4;&#x88C5;TFRecord&#x6570;&#x636E;</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.tensorflow.example.Example;</span><br><span class="line"><span class="keyword">import</span> org.tensorflow.example.SequenceExample;</span><br><span class="line"><span class="keyword">import</span> top.ritchie.tensorflow.utils.feature.FeatureUtils;</span><br><span class="line"><span class="keyword">import</span> top.ritchie.tensorflow.utils.feature.TFRecordGen;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    git@github.com:ritchietop/tensorflow-utils.git</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleGen</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Example example = <span class="keyword">new</span> TFRecordGen(<span class="number">5</span>)</span><br><span class="line">                .put(<span class="string">&quot;featureA&quot;</span>, FeatureUtils.byteStringFeature(<span class="string">&quot;valueA1&quot;</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureB&quot;</span>, FeatureUtils.floatListFeature(<span class="number">2.3</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureC&quot;</span>, FeatureUtils.byteStringFeature(<span class="string">&quot;valueC3&quot;</span>, <span class="string">&quot;valueC2&quot;</span>, <span class="string">&quot;valueC8&quot;</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureD&quot;</span>, FeatureUtils.int64ListFeature(<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureE&quot;</span>, FeatureUtils.byteStringFeature(<span class="string">&quot;valueE3&quot;</span>, <span class="string">&quot;valueE8&quot;</span>, <span class="string">&quot;valueE3&quot;</span>, <span class="string">&quot;valueE9&quot;</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureF&quot;</span>, FeatureUtils.floatListFeature(<span class="number">4.5</span>, <span class="number">1.2</span>, <span class="number">2.1</span>))</span><br><span class="line">                .genExample();</span><br><span class="line">        SequenceExample sequenceExample = <span class="keyword">new</span> TFRecordGen(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">                .put(<span class="string">&quot;featureA&quot;</span>, FeatureUtils.byteStringFeature(<span class="string">&quot;valueA2&quot;</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureB&quot;</span>, FeatureUtils.floatListFeature(<span class="number">4.1</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureC&quot;</span>, FeatureUtils.byteStringFeature(<span class="string">&quot;valueC1&quot;</span>, <span class="string">&quot;valueC2&quot;</span>, <span class="string">&quot;valueC3&quot;</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureD&quot;</span>, FeatureUtils.int64ListFeature())</span><br><span class="line">                .put(<span class="string">&quot;featureE&quot;</span>, FeatureUtils.byteStringFeature(<span class="string">&quot;valueE6&quot;</span>, <span class="string">&quot;valueE1&quot;</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureF&quot;</span>, FeatureUtils.floatListFeature(<span class="number">9.4</span>, <span class="number">6.6</span>, <span class="number">8.3</span>, <span class="number">7.2</span>, <span class="number">9.1</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureG&quot;</span>, FeatureUtils.toFeatureList(</span><br><span class="line">                    FeatureUtils.byteStringFeature(<span class="string">&quot;valueG2&quot;</span>, <span class="string">&quot;valueG1&quot;</span>),</span><br><span class="line">                    FeatureUtils.byteStringFeature(<span class="string">&quot;valueG6&quot;</span>, <span class="string">&quot;valueG6&quot;</span>)</span><br><span class="line">                ))</span><br><span class="line">                .put(<span class="string">&quot;featureH&quot;</span>, FeatureUtils.toFeatureList(</span><br><span class="line">                    FeatureUtils.int64ListFeature(<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>),</span><br><span class="line">                    FeatureUtils.int64ListFeature(<span class="number">4</span>, <span class="number">2</span>, <span class="number">9</span>),</span><br><span class="line">                    FeatureUtils.int64ListFeature(<span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>)</span><br><span class="line">                ))</span><br><span class="line">                .put(<span class="string">&quot;featureI_Index0&quot;</span>, FeatureUtils.int64ListFeature(<span class="number">5</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">6</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureI_Index1&quot;</span>, FeatureUtils.int64ListFeature(<span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureI_Index2&quot;</span>, FeatureUtils.int64ListFeature(<span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>))</span><br><span class="line">                .put(<span class="string">&quot;featureI_value&quot;</span>, FeatureUtils.byteStringFeature(<span class="string">&quot;valueI3&quot;</span>, <span class="string">&quot;valueI5&quot;</span>, <span class="string">&quot;valueI2&quot;</span>, <span class="string">&quot;valueI7&quot;</span>, <span class="string">&quot;valueI5&quot;</span>))</span><br><span class="line">                .genSequenceExample();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3>&#x4F7F;&#x7528;Spark&#x5FEB;&#x901F;&#x8BFB;&#x5199;TFRecord&#x6570;&#x636E;</h3>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.{BytesWritable, NullWritable}</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.{SparkConf, SparkContext}</span><br><span class="line"><span class="keyword">import</span> org.tensorflow.spark.shaded.org.tensorflow.hadoop.io.{TFRecordFileInputFormat, TFRecordFileOutputFormat}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;org.tensorflow&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;spark-tensorflow-connector_2.11&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;1.15.0&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">object ExampleGen {</span><br><span class="line"></span><br><span class="line">    def main(args: <span class="type">Array</span>[<span class="keyword">String</span>]): <span class="type">Unit </span>= {</span><br><span class="line">        val sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;ExampleGenTask&quot;</span>).setMaster(<span class="string">&quot;local&quot;</span>))</span><br><span class="line">        <span class="comment">// TFRecord&#x5199;&#x5165;</span></span><br><span class="line">        sc.makeRDD(Seq(example, sequenceExample)).repartition(<span class="number">1</span>)</span><br><span class="line">        .map(example =&gt; (<span class="keyword">new</span> <span class="type">BytesWritable</span>(example.toByteArray), NullWritable.<span class="keyword">get</span>()))</span><br><span class="line">        .saveAsNewAPIHadoopFile[TFRecordFileOutputFormat](<span class="string">&quot;path/data&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TFRecord&#x8BFB;&#x53D6;</span></span><br><span class="line">        sc.<span class="keyword">new</span><span class="type">APIHadoopFile</span>(<span class="string">&quot;path/data&quot;</span>, classOf[TFRecordFileInputFormat], classOf[BytesWritable], classOf[NullWritable])</span><br><span class="line">        .map { <span class="keyword">case</span> (bytesWritable, nullWritable) =&gt; SequenceExample.parseFrom(bytesWritable.getBytes) }</span><br><span class="line">        .collect()</span><br><span class="line">        .foreach(println)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2>TFRecord&#x6570;&#x636E;&#x8BFB;&#x5199;&#xFF08;python&#x7248;&#xFF09;</h2>
<h3>TFRecord&#x5199;&#x5165;&#x6837;&#x4F8B;</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">writer = tf.io.TFRecordWriter(<span class="string">&quot;path/tfrecord&quot;</span>)</span><br><span class="line"></span><br><span class="line">example = tf.train.Example(features=tf.train.Features(feature={</span><br><span class="line">    <span class="string">&quot;featureA&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">u&quot;valueA1&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)])),</span><br><span class="line">    <span class="string">&quot;featureB&quot;</span>: tf.train.Feature(float_list=tf.train.FloatList(value=[<span class="number">2.3</span>])),</span><br><span class="line">    <span class="string">&quot;featureC&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">b&quot;valueC3&quot;</span>, <span class="string">b&quot;valueC2&quot;</span>, <span class="string">b&quot;valueC8&quot;</span>])),</span><br><span class="line">    <span class="string">&quot;featureD&quot;</span>: tf.train.Feature(int64_list=tf.train.Int64List(value=[<span class="number">3</span>, <span class="number">4</span>])),</span><br><span class="line">    <span class="string">&quot;featureE&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">b&quot;valueE3&quot;</span>, <span class="string">b&quot;valueE8&quot;</span>, <span class="string">b&quot;valueE3&quot;</span>, <span class="string">b&quot;valueE9&quot;</span>])),</span><br><span class="line">    <span class="string">&quot;featureF&quot;</span>: tf.train.Feature(float_list=tf.train.FloatList(value=[<span class="number">4.5</span>, <span class="number">1.2</span>, <span class="number">2.1</span>]))</span><br><span class="line">}))</span><br><span class="line"></span><br><span class="line">sequence_example = tf.train.SequenceExample(</span><br><span class="line">    context=tf.train.Features(feature={</span><br><span class="line">        <span class="string">&quot;featureA&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">b&quot;valueA2&quot;</span>])),</span><br><span class="line">        <span class="string">&quot;featureB&quot;</span>: tf.train.Feature(float_list=tf.train.FloatList(value=[<span class="number">4.1</span>])),</span><br><span class="line">        <span class="string">&quot;featureC&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">b&quot;valueC1&quot;</span>, <span class="string">b&quot;valueC2&quot;</span>, <span class="string">b&quot;valueC3&quot;</span>])),</span><br><span class="line">        <span class="string">&quot;featureE&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">b&quot;valueE6&quot;</span>, <span class="string">b&quot;valueE1&quot;</span>])),</span><br><span class="line">        <span class="string">&quot;featureF&quot;</span>: tf.train.Feature(float_list=tf.train.FloatList(value=[<span class="number">9.4</span>, <span class="number">6.6</span>, <span class="number">8.3</span>, <span class="number">7.2</span>, <span class="number">9.1</span>])),</span><br><span class="line">        <span class="string">&quot;featureI_Index0&quot;</span>: tf.train.Feature(int64_list=tf.train.Int64List(value=[<span class="number">5</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">6</span>])),</span><br><span class="line">        <span class="string">&quot;featureI_Index1&quot;</span>: tf.train.Feature(int64_list=tf.train.Int64List(value=[<span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>])),</span><br><span class="line">        <span class="string">&quot;featureI_Index2&quot;</span>: tf.train.Feature(int64_list=tf.train.Int64List(value=[<span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>])),</span><br><span class="line">        <span class="string">&quot;featureI_value&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">b&quot;valueI3&quot;</span>, <span class="string">b&quot;valueI5&quot;</span>, <span class="string">b&quot;valueI2&quot;</span>, <span class="string">b&quot;valueI7&quot;</span>, <span class="string">b&quot;valueI5&quot;</span>]))</span><br><span class="line">    }),</span><br><span class="line">    feature_lists=tf.train.FeatureLists(feature_list={</span><br><span class="line">        <span class="string">&quot;featureG&quot;</span>: tf.train.FeatureList(feature=[</span><br><span class="line">            tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">b&quot;valueG2&quot;</span>, <span class="string">b&quot;valueG1&quot;</span>])),</span><br><span class="line">            tf.train.Feature(bytes_list=tf.train.BytesList(value=[<span class="string">b&quot;valueG6&quot;</span>, <span class="string">u&quot;valueG6&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)]))</span><br><span class="line">        ]),</span><br><span class="line">        <span class="string">&quot;featureH&quot;</span>: tf.train.FeatureList(feature=[</span><br><span class="line">            tf.train.Feature(int64_list=tf.train.Int64List(value=[<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>])),</span><br><span class="line">            tf.train.Feature(int64_list=tf.train.Int64List(value=[<span class="number">4</span>, <span class="number">2</span>, <span class="number">9</span>])),</span><br><span class="line">            tf.train.Feature(int64_list=tf.train.Int64List(value=[<span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>]))</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">writer.write(example.SerializeToString())</span><br><span class="line">writer.write(sequence_example.SerializeToString())</span><br><span class="line"></span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
<h3>TFRecord&#x89E3;&#x6790;</h3>
<p>&#x4F7F;&#x7528;tf.io.parse_single_sequence_example&#x89E3;&#x6790;SequenceExample&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4E0D;&#x652F;&#x6301;tf.io.SparseFeature&#x7279;&#x5F81;&#x5217;&#xFF0C;&#x6240;&#x4EE5;&#x89E3;&#x6790;&#x7684;&#x65F6;&#x5019;&#x628A;featureI&#x5254;&#x9664;&#x4E86;&#x3002;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">context_schema = {</span><br><span class="line">    <span class="string">&quot;featureA&quot;</span>: column_schema[<span class="string">&quot;featureA&quot;</span>],</span><br><span class="line">    <span class="string">&quot;featureB&quot;</span>: column_schema[<span class="string">&quot;featureB&quot;</span>],</span><br><span class="line">    <span class="string">&quot;featureC&quot;</span>: column_schema[<span class="string">&quot;featureC&quot;</span>],</span><br><span class="line">    <span class="string">&quot;featureD&quot;</span>: column_schema[<span class="string">&quot;featureD&quot;</span>],</span><br><span class="line">    <span class="string">&quot;featureE&quot;</span>: column_schema[<span class="string">&quot;featureE&quot;</span>],</span><br><span class="line">    <span class="string">&quot;featureF&quot;</span>: column_schema[<span class="string">&quot;featureF&quot;</span>],</span><br><span class="line">    <span class="string">&quot;featureI&quot;</span>: column_schema[<span class="string">&quot;featureI&quot;</span>],</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">sequence_schema = {</span><br><span class="line">    <span class="string">&quot;featureG&quot;</span>: column_schema[<span class="string">&quot;featureG&quot;</span>],</span><br><span class="line">    <span class="string">&quot;featureH&quot;</span>: column_schema[<span class="string">&quot;featureH&quot;</span>],</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x8FD9;&#x4E2A;&#x662F;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#x9AD8;&#x6548;&#x52A0;&#x8F7D;&#x5916;&#x90E8;&#x6570;&#x636E;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x53EF;&#x4EE5;&#x53C2;&#x52A0;tensorflow dataset</span></span><br><span class="line">data = tf.data.TFRecordDataset(filenames=<span class="string">&quot;path/tfrecord&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, record <span class="keyword">in</span> enumerate(data):</span><br><span class="line">    <span class="keyword">if</span> index == <span class="number">0</span>:</span><br><span class="line">        example = tf.io.parse_single_example(record, features=context_schema)</span><br><span class="line">        print(<span class="string">&quot;======================example======================&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> example.items():</span><br><span class="line">            print(key, <span class="string">&quot;=&gt;&quot;</span>, value)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># &#x5254;&#x9664;SparseFeature&#x7279;&#x5F81;</span></span><br><span class="line">        context_schema.pop(<span class="string">&quot;featureI&quot;</span>)</span><br><span class="line">        <span class="comment"># &#x8FD9;&#x91CC;&#x8FD4;&#x56DE;&#x4E24;&#x4E2A;dict&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94;contextFeatures&#x548C;sequenceFeature</span></span><br><span class="line">        (context, sequence) = tf.io.parse_single_sequence_example(</span><br><span class="line">            record, context_features=context_schema, sequence_features=sequence_schema)</span><br><span class="line">        print(<span class="string">&quot;==============sequenceExample: context==============&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> context.items():</span><br><span class="line">            print(key, <span class="string">&quot;=&gt;&quot;</span>, value)</span><br><span class="line">        print(<span class="string">&quot;==============sequenceExample: featureList==============&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> sequence.items():</span><br><span class="line">            print(key, <span class="string">&quot;=&gt;&quot;</span>, value)</span><br></pre></td></tr></table></figure>
<p>&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#x89E3;&#x6790;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">======================<span class="attribute">example</span>======================</span><br><span class="line">featureA =&gt; tf.Tensor([b<span class="string">&apos;valueA1&apos;</span>], shape=(1,), <span class="attribute">dtype</span>=string)</span><br><span class="line">featureB =&gt; tf.Tensor([2.3], shape=(1,), <span class="attribute">dtype</span>=float32)</span><br><span class="line">featureC =&gt; tf.Tensor([b<span class="string">&apos;valueC3&apos;</span> b<span class="string">&apos;valueC2&apos;</span> b<span class="string">&apos;valueC8&apos;</span>], shape=(3,), <span class="attribute">dtype</span>=string)</span><br><span class="line">featureD =&gt; tf.Tensor([3 4], shape=(2,), <span class="attribute">dtype</span>=int64)</span><br><span class="line">featureE =&gt; SparseTensor(<span class="attribute">indices</span>=tf.Tensor(</span><br><span class="line">[[0]</span><br><span class="line"> [1]</span><br><span class="line"> [2]</span><br><span class="line"> [3]], shape=(4, 1), <span class="attribute">dtype</span>=int64), <span class="attribute">values</span>=tf.Tensor([b<span class="string">&apos;valueE3&apos;</span> b<span class="string">&apos;valueE8&apos;</span> b<span class="string">&apos;valueE3&apos;</span> b<span class="string">&apos;valueE9&apos;</span>], shape=(4,), <span class="attribute">dtype</span>=string), <span class="attribute">dense_shape</span>=tf.Tensor([4], shape=(1,), <span class="attribute">dtype</span>=int64))</span><br><span class="line">featureF =&gt; SparseTensor(<span class="attribute">indices</span>=tf.Tensor(</span><br><span class="line">[[0]</span><br><span class="line"> [1]</span><br><span class="line"> [2]], shape=(3, 1), <span class="attribute">dtype</span>=int64), <span class="attribute">values</span>=tf.Tensor([4.5 1.2 2.1], shape=(3,), <span class="attribute">dtype</span>=float32), <span class="attribute">dense_shape</span>=tf.Tensor([3], shape=(1,), <span class="attribute">dtype</span>=int64))</span><br><span class="line">featureI =&gt; SparseTensor(<span class="attribute">indices</span>=tf.Tensor([], shape=(0, 3), <span class="attribute">dtype</span>=int64), <span class="attribute">values</span>=tf.Tensor([], shape=(0,), <span class="attribute">dtype</span>=string), <span class="attribute">dense_shape</span>=tf.Tensor([21  4 10], shape=(3,), <span class="attribute">dtype</span>=int64))</span><br><span class="line">==============sequenceExample: <span class="attribute">context</span>==============</span><br><span class="line">featureA =&gt; tf.Tensor([b<span class="string">&apos;valueA2&apos;</span>], shape=(1,), <span class="attribute">dtype</span>=string)</span><br><span class="line">featureB =&gt; tf.Tensor([4.1], shape=(1,), <span class="attribute">dtype</span>=float32)</span><br><span class="line">featureC =&gt; tf.Tensor([b<span class="string">&apos;valueC1&apos;</span> b<span class="string">&apos;valueC2&apos;</span> b<span class="string">&apos;valueC3&apos;</span>], shape=(3,), <span class="attribute">dtype</span>=string)</span><br><span class="line">featureD =&gt; tf.Tensor([0 0], shape=(2,), <span class="attribute">dtype</span>=int64)</span><br><span class="line">featureE =&gt; SparseTensor(<span class="attribute">indices</span>=tf.Tensor(</span><br><span class="line">[[0]</span><br><span class="line"> [1]], shape=(2, 1), <span class="attribute">dtype</span>=int64), <span class="attribute">values</span>=tf.Tensor([b<span class="string">&apos;valueE6&apos;</span> b<span class="string">&apos;valueE1&apos;</span>], shape=(2,), <span class="attribute">dtype</span>=string), <span class="attribute">dense_shape</span>=tf.Tensor([2], shape=(1,), <span class="attribute">dtype</span>=int64))</span><br><span class="line">featureF =&gt; SparseTensor(<span class="attribute">indices</span>=tf.Tensor(</span><br><span class="line">[[0]</span><br><span class="line"> [1]</span><br><span class="line"> [2]</span><br><span class="line"> [3]</span><br><span class="line"> [4]], shape=(5, 1), <span class="attribute">dtype</span>=int64), <span class="attribute">values</span>=tf.Tensor([9.4 6.6 8.3 7.2 9.1], shape=(5,), <span class="attribute">dtype</span>=float32), <span class="attribute">dense_shape</span>=tf.Tensor([5], shape=(1,), <span class="attribute">dtype</span>=int64))</span><br><span class="line">==============sequenceExample: <span class="attribute">featureList</span>==============</span><br><span class="line">featureG =&gt; tf.Tensor(</span><br><span class="line">[[b<span class="string">&apos;valueG2&apos;</span> b<span class="string">&apos;valueG1&apos;</span>]</span><br><span class="line"> [b<span class="string">&apos;valueG6&apos;</span> b<span class="string">&apos;valueG6&apos;</span>]], shape=(2, 2), <span class="attribute">dtype</span>=string)</span><br><span class="line">featureH =&gt; tf.Tensor(</span><br><span class="line">[[1 1 3]</span><br><span class="line"> [4 2 9]</span><br><span class="line"> [8 4 2]], shape=(3, 3), <span class="attribute">dtype</span>=int64)</span><br></pre></td></tr></table></figure>
<h4>Example&#x89E3;&#x6790;API</h4>
<ul>
<li>tf.io.parse_single_example(serialized, features)</li>
<li>tf.io.parse_example(serialized, features)</li>
<li>tf.io.parse_single_sequence_example(serialized, context_features=None, sequence_features=None)</li>
<li>tf.io.parse_sequence_example(serialized, context_features=None, sequence_features=None)</li>
</ul>
<p>single&#x7248;&#x89E3;&#x6790;&#x5355;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x975E;single&#x7248;&#x9700;&#x8981;&#x52A0;&#x4E00;&#x4E2A;batch&#x7EF4;&#x5EA6;&#x3002;&#x5176;&#x4F59;&#x65B9;&#x9762;&#x4E24;&#x8005;&#x7528;&#x6CD5;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#x3002;</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://www.ritchie.top/2019/12/25/tensorflow-tfrecord-process/" data-id="ck5610qhu00074oz6l9oliwhr" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACs0lEQVR42u3aW27DMAwEwNz/0ukBAtu7kpi2wPgraOLH+ENUl3y94uP9cXz+/f7cz8/3v7m612viwMPDw9t+9IRx9cv7a7Z3zF/B5YvGw8PDG+OtLeh5Mbi/y9W9ks8PFjw8PLx/yGv3uvlWHg8PD++/8HY2022p+IXCgIeHhxfz8mggjwnaiDY5azBrwcPDw4t5a+HC734e6e/h4eHhbXfV8wV3rbnVDiLUT4uHh4c3wNuJXPebW2srfP1LPDw8vGFeGyXkj75fJNpz8fDw8CZ494Hs2oBUW0KS9li+oX8ll8bDw8M7xFsbb8rj17y1dizIwMPDwxvjteVhv9nfRgxbXTs8PDy8sSNZfNeo7RDA/d0XixkeHh7eUV6+2W1bU3kYsR89PEQSeHh4eId476WjvcLajrf99rIBhoeHhzfAa5fjBLnTNmvLwOVZeHh4eMO8ZLlvw4W2ndYONzw8Gx4eHt4Ab+1CbWxxalygDXzx8PDwJnhrY1I7Ee3ZMOLhOfHw8PAGeO0oQFIM2mZY8nBrYDw8PLwJXhutnprwattp+aADHh4e3nd4bRyQt6/aV7BTzRaHrvDw8PAO8daW7/bR135ZDC7g4eHhDfDaZXfnFSSjXfmRb/Tx8PDw5njtxEHednovHcnGOoqD8fDw8IZ5+SKeb6PzEYS8eBRn4eHh4X2Flzf1z45G7ZeZhy01Hh4e3lFevnyvlYE8yGhHXR/KBh4eHt5R3lpA0Ea9p0pI3QbDw8PDG+C1S+3ORZMr3P99LTTBw8PDm+DV/97Hy/0aJi8b0YvGw8PDG+OtbXzbopJHEu3166/x8PDwvsjLY4gkDs5HAdphLDw8PLy/yduJbtvysDbChYeHhzfHa5tPO9HDRAvt8iw8PDy8AV77D3+7Fb7/ZVt+Bvt7eHh4eM9n/QBgLtpPTD/SOAAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/tensorflow-tfrecord-sequenceExample-spark-feature/">tensorflow tfrecord sequenceExample spark feature</a></div><div class="post-nav"><a class="pre" href="/2019/12/28/tensorflow-dataset/">【tensorflow】Dataset简明教程</a><a class="next" href="/2019/12/24/tensorflow-tfrecord-basic_datastruct/">【tensorflow】TFRecord数据结构</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: 'e1d9a23bff9cf37a908f',
  clientSecret: 'e940ee66119d68ddc9e557b57925f146ff8e180f',
  repo: 'ritchietop.github.io',
  owner: 'ritchietop',
  admin: ['ritchietop'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/paper/">paper</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tensorflow/">tensorflow</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/tensorflow-dataset-pipeline/" style="font-size: 15px;">tensorflow dataset pipeline</a> <a href="/tags/dnn-recommendation/" style="font-size: 15px;">dnn recommendation</a> <a href="/tags/tensorflow-tfrecord-sequenceExample/" style="font-size: 15px;">tensorflow tfrecord sequenceExample</a> <a href="/tags/tensorflow-tfrecord-sequenceExample-spark-feature/" style="font-size: 15px;">tensorflow tfrecord sequenceExample spark feature</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/28/tensorflow-dataset/">【tensorflow】Dataset简明教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/25/tensorflow-tfrecord-process/">【tensorflow】TFRecord数据读写</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/24/tensorflow-tfrecord-basic_datastruct/">【tensorflow】TFRecord数据结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/15/paper-reading-youtube-dnn-recommendation/">【论文小品】Deep neural networks for YouTube recommendations</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/08/simple-markdown-syntax/">简明Markdown语法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://tf.wiki/" title="简单粗暴 TensorFlow 2.0" target="_blank">简单粗暴 TensorFlow 2.0</a><ul></ul><a href="https://keras.io/zh/" title="Keras: 基于 Python 的深度学习库" target="_blank">Keras: 基于 Python 的深度学习库</a><ul></ul><a href="https://leetcode-cn.com/" title="力扣（LeetCode）" target="_blank">力扣（LeetCode）</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Ritchie's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>