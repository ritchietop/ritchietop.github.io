<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="python, scala, spark, hive, hbase, hadoop, tensorflow, flink, 机器学习, 深度学习, 算法"><title>【Tensorflow2】FeatureColumn简明教程 | Ritchie's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '87868a9c378cabc27812ae2d1ebfbb13';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【Tensorflow2】FeatureColumn简明教程</h1><a id="logo" href="/.">Ritchie's Blog</a><p class="description">点滴记录，技术提升进程</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-list"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于我</i></a><a href="/timeline/"><i class="fa fa-history"> 大事记</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【Tensorflow2】FeatureColumn简明教程</h1><div class="post-meta">Jan 22, 2020<span> | </span><span class="category"><a href="/categories/tensorflow/">tensorflow</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><p><code>tf.feature_column</code>&#x662F;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x5957;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x7ED3;&#x6784;&#x5316;&#x6570;&#x636E;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x5B83;&#x662F;&#x539F;&#x59CB;&#x6570;&#x636E;&#x548C;<code>Estimator</code>&#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x6865;&#x6881;&#x3002;&#x4E30;&#x5BCC;&#x7684;<code>tf.feature_column</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8BA9;&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x5404;&#x79CD;&#x539F;&#x59CB;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x4E3A;<code>Estimators</code>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x4ECE;&#x800C;&#x66F4;&#x52A0;&#x5BB9;&#x6613;&#x7684;&#x8FDB;&#x884C;&#x6A21;&#x578B;&#x5B9E;&#x9A8C;&#x3002;</p>
<a id="more"></a>
<img src="/2020/01/22/tensorflow2-feature-column/inputs_to_model_bridge.jpg" title="&#x6570;&#x636E;&#x4E0E;&#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x6865;&#x6881;">
<p>&#x8FD9;&#x91CC;&#x6211;&#x5C06;&#x5BF9;<code>tf.feature_column</code>&#x76EE;&#x524D;&#x652F;&#x6301;&#x7684;16&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x4F7F;&#x7528;&#x8FDB;&#x884C;&#x8BF4;&#x660E;&#x548C;&#x6F14;&#x793A;&#x3002;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x793A;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;<code>tf.feature_column</code>&#x652F;&#x6301;&#x7684;&#x6240;&#x6709;&#x7279;&#x5F81;&#x5217;&#x90FD;&#x7EE7;&#x627F;&#x81EA;<code>FeatureColumn</code>&#x7C7B;&#x3002;&#x901A;&#x8FC7;<code>FeatureColumn</code>&#x53C8;&#x5F15;&#x7533;&#x51FA;&#x4E09;&#x4E2A;&#x5B50;&#x7C7B;<code>CategoricalColumn</code>&#x3001;<code>DenseColumn</code>&#x3001;<code>SequenceDenseColumn</code>&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x3001;&#x8FDE;&#x7EED;&#x7279;&#x5F81;&#x3001;&#x8FDE;&#x7EED;&#x5E8F;&#x5217;&#x7279;&#x5F81;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x4F3C;<code>tf.feature_column</code>&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x7EE7;&#x627F;&#x8FD9;&#x4E09;&#x4E2A;&#x7279;&#x5F81;&#x5217;&#x6765;&#x8986;&#x5199;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x53EA;&#x4ECB;&#x7ECD;&#x5B98;&#x65B9;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;&#x90E8;&#x5206;&#x540E;&#x7EED;&#x4F1A;&#x518D;&#x5206;&#x4EAB;&#x3002;</p>
<img src="/2020/01/22/tensorflow2-feature-column/feature_column_methods.jpg" title="&#x6570;&#x636E;&#x4E0E;&#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x6865;&#x6881;">
<p>&#x9664;&#x4E86;&#x4E0A;&#x9762;<code>tf.feature_column</code>&#x65B9;&#x6CD5;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7684;&#x4ECB;&#x7ECD;&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x540E;&#x9762;&#x7684;&#x6F14;&#x793A;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x4E24;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x7C7B;<code>FeatureTransformationCache</code>&#x548C;<code>StateManager</code>&#x3002;<br>
<code>FeatureTransformationCache</code>&#x662F;&#x8F93;&#x5165;&#x6570;&#x636E;&#x7684;&#x6301;&#x6709;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x5C06;&#x8F93;&#x5165;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x4ECE;&#x800C;&#x65B9;&#x4FBF;&#x540E;&#x7EED;&#x5BF9;&#x7279;&#x5F81;&#x7684;&#x591A;&#x6B21;&#x4F7F;&#x7528;&#x3002;<code>FeatureTransformationCache</code>&#x7684;&#x672C;&#x8D28;&#x5C31;&#x662F;<code>dict</code>&#x3002;<br>
<code>StateManager</code>&#x662F;&#x4E3A;&#x5177;&#x6709;&#x72B6;&#x6001;&#x6570;&#x636E;&#x7684;&#x7279;&#x5F81;&#x5217;&#x63D0;&#x4F9B;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#xFF0C;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x72B6;&#x6001;&#x7684;&#x521B;&#x5EFA;&#x3001;&#x589E;&#x52A0;&#x3001;&#x83B7;&#x53D6;&#x7B49;&#x3002;&#x5B98;&#x65B9;&#x7ED9;&#x51FA;&#x7684;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x662F;&#x5C06;<code>StateManager</code>&#x4E0E;<code>Layer</code>&#x5173;&#x8054;&#xFF0C;&#x5C06;&#x72B6;&#x6001;&#x6570;&#x636E;&#x5B58;&#x5230;<code>Layer</code>&#x4E2D;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;<br>
&#x9884;&#x5907;&#x77E5;&#x8BC6;&#x57FA;&#x672C;&#x5C31;&#x8FD9;&#x4E9B;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x5BF9;&#x6BCF;&#x4E2A;<code>tf.feature_column</code>&#x65B9;&#x6CD5;&#x4F9D;&#x6B21;&#x8FDB;&#x884C;&#x8BF4;&#x660E;&#x3002;</p>
<h1>CategoricalColumn&#x7CFB;&#x5217;</h1>
<p><code>CategoricalColumn</code>&#x6D3E;&#x751F;&#x51FA;&#x7684;10&#x4E2A;&#x7279;&#x5F81;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x529F;&#x80FD;&#x4E0A;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x533A;&#x522B;&#x4E3B;&#x8981;&#x5728;&#x4E8E;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x6620;&#x5C04;&#x4E3A;&#x6570;&#x503C;&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x6CD5;&#x4E0D;&#x540C;&#xFF1A;</p>
<ul>
<li><code>tf.feature_column.categorical_column_with_vocabulary_list</code>&#xFF1A;&#x901A;&#x8FC7;&#x5B9A;&#x4E49;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x7684;&#x53D6;&#x503C;&#x5217;&#x8868;&#xFF0C;&#x5C06;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x6620;&#x5C04;&#x4E3A;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x5217;&#x8868;&#x4E0B;&#x6807;&#xFF08;&#x4ECE;0&#x5F00;&#x59CB;&#xFF09;&#x3002;</li>
<li><code>tf.feature_column.sequence_categorical_column_with_vocabulary_list</code>&#xFF1A;&#x540C;&#x4E0A;&#xFF0C;&#x533A;&#x522B;&#x662F;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x79BB;&#x6563;&#x5E8F;&#x5217;&#x7279;&#x5F81;&#x3002;</li>
<li><code>tf.feature_column.categorical_column_with_vocabulary_file</code>&#xFF1A;&#x901A;&#x8FC7;&#x5B9A;&#x4E49;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x7684;&#x53D6;&#x503C;&#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x6620;&#x5C04;&#x4E3A;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x884C;&#x6570;&#xFF08;&#x4ECE;0&#x5F00;&#x59CB;&#xFF09;&#x3002;</li>
<li><code>tf.feature_column.sequence_categorical_column_with_vocabulary_file</code>&#xFF1A;&#x540C;&#x4E0A;&#xFF0C;&#x533A;&#x522B;&#x662F;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x79BB;&#x6563;&#x5E8F;&#x5217;&#x7279;&#x5F81;&#x3002;</li>
<li><code>tf.feature_column.categorical_column_with_identity</code>&#xFF1A;&#x662F;&#x5C06;&#x6570;&#x503C;&#x7279;&#x5F81;&#x89C6;&#x4E3A;&#x79BB;&#x6563;&#x7279;&#x5F81;&#xFF0C;&#x5E76;&#x76F4;&#x63A5;&#x6620;&#x5C04;&#x5230;&#x81EA;&#x8EAB;&#x3002;</li>
<li><code>tf.feature_column.sequence_categorical_column_with_identity</code>&#xFF1A;&#x540C;&#x4E0A;&#xFF0C;&#x533A;&#x522B;&#x662F;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x79BB;&#x6563;&#x5E8F;&#x5217;&#x7279;&#x5F81;&#x3002;</li>
<li><code>tf.feature_column.categorical_column_with_hash_bucket</code>&#xFF1A;&#x901A;&#x8FC7;&#x5B9A;&#x4E49;hash&#x7684;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#xFF0C;&#x5C06;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x6620;&#x5C04;&#x4E3A;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x54C8;&#x5E0C;&#x503C;&#x3002;</li>
<li><code>tf.feature_column.sequence_categorical_column_with_hash_bucket</code>&#xFF1A;&#x540C;&#x4E0A;&#xFF0C;&#x533A;&#x522B;&#x662F;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x79BB;&#x6563;&#x5E8F;&#x5217;&#x7279;&#x5F81;&#x3002;</li>
<li><code>tf.feature_column.crossed_column</code>&#xFF1A;&#x901A;&#x8FC7;&#x5B9A;&#x4E49;hash&#x7684;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#xFF0C;&#x5BF9;&#x6307;&#x5B9A;&#x7279;&#x5F81;&#x5217;&#x8868;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5217;&#x8FDB;&#x884C;&#x4EA4;&#x53C9;&#xFF0C;&#x5C06;&#x4EA4;&#x53C9;&#x540E;&#x7684;&#x79BB;&#x6563;&#x503C;&#x6620;&#x5C04;&#x4E3A;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x54C8;&#x5E0C;&#x503C;&#x3002;</li>
<li><code>tf.feature_column.weighted_categorical_column</code>&#xFF1A;&#x8FD9;&#x4E2A;&#x662F;&#x5E26;&#x6743;&#x7279;&#x5F81;&#x5217;&#xFF0C;&#x53EA;&#x662F;&#x5C06;<code>CategoricalColumn</code>&#x548C;<code>DenseColumn</code>&#x8FDB;&#x884C;&#x7EC4;&#x5408;&#xFF0C;&#x672C;&#x8EAB;&#x5E76;&#x4E0D;&#x5B9A;&#x4E49;&#x6620;&#x5C04;&#x65B9;&#x6CD5;&#x3002;</li>
</ul>
<h2>CategoricalColumn&#x81EA;&#x5B9A;&#x4E49;&#x65B9;&#x6CD5;</h2>
<h3>get_sparse_tensors(transformation_cache, state_manager)</h3>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;IdWeightPair(id_tensor, weight_tensor)&#x3002;id_tensor&#x8868;&#x793A;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x8FDB;&#x8FC7;&#x6570;&#x503C;&#x6620;&#x5C04;&#xFF08;&#x4F8B;&#x5982;hash&#xFF09;&#x4E4B;&#x540E;&#x7684;SparseTensor&#x5F62;&#x5F0F;&#xFF0C;&#x5176;&#x5BF9;&#x5E94;&#x7684;values&#x662F;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x6620;&#x5C04;&#x540E;&#x7684;&#x6570;&#x503C;&#xFF08;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x5E76;&#x4E0D;&#x662F;one-hot/multi-hot&#x7684;SparseTensor&#x5F62;&#x5F0F;&#xFF09;&#x3002;weight_tensor&#x8868;&#x793A;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x5BF9;&#x5E94;&#x7684;&#x6743;&#x91CD;&#x503C;&#x3002;</p>
<h3>num_buckets()</h3>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6570;&#x503C;&#xFF0C;&#x8868;&#x793A;&#x79BB;&#x6563;&#x7279;&#x5F81;&#x6620;&#x5C04;&#x4E3A;&#x6570;&#x503C;&#x7C7B;&#x578B;&#x540E;&#x7684;&#x53D6;&#x503C;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x901A;&#x8FC7;one-hot&#x7F16;&#x7801;&#x540E;&#x7684;&#x5411;&#x91CF;&#x7EF4;&#x5EA6;&#x5927;&#x5C0F;&#x3002;</p>
<h2>categorical_column_with_vocabulary_list</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">categorical_list_column</span><span class="params">()</span>:</span></span><br><span class="line">    column = tf.feature_column.categorical_column_with_vocabulary_list(</span><br><span class="line">        <span class="comment"># &#x7279;&#x5F81;&#x5217;&#x7684;&#x540D;&#x79F0;</span></span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        <span class="comment"># &#x6709;&#x6548;&#x53D6;&#x503C;&#x5217;&#x8868;&#xFF0C;&#x5217;&#x8868;&#x7684;&#x4E0B;&#x6807;&#x5BF9;&#x5E94;&#x8F6C;&#x6362;&#x7684;&#x6570;&#x503C;&#x3002;&#x5373;&#xFF0C;value1&#x4F1A;&#x88AB;&#x6620;&#x5C04;&#x4E3A;0</span></span><br><span class="line">        vocabulary_list=[<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>, <span class="string">&quot;value3&quot;</span>],</span><br><span class="line">        <span class="comment"># &#x53D6;&#x503C;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x53EA;&#x652F;&#x6301;string&#x548C;integer&#xFF0C;&#x8FD9;&#x4E2A;&#x4F1A;&#x6839;&#x636E;vocabulary_list&#x81EA;&#x52A8;&#x63A8;&#x65AD;&#x51FA;&#x6765;</span></span><br><span class="line">        dtype=tf.string,</span><br><span class="line">        <span class="comment"># &#x5F53;&#x53D6;&#x503C;&#x4E0D;&#x5728;vocabulary_list&#x4E2D;&#x65F6;&#xFF0C;&#x4F1A;&#x88AB;&#x6620;&#x5C04;&#x7684;&#x6570;&#x503C;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;-1</span></span><br><span class="line">        <span class="comment"># &#x5F53;&#x8BE5;&#x503C;&#x4E0D;&#x4E3A;-1&#x65F6;&#xFF0C;num_oov_buckets&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E3A;0&#x3002;&#x5373;&#x4E24;&#x8005;&#x4E0D;&#x80FD;&#x540C;&#x65F6;&#x8D77;&#x4F5C;&#x7528;</span></span><br><span class="line">        default_value=<span class="number">-1</span>,</span><br><span class="line">        <span class="comment"># &#x4F5C;&#x7528;&#x540C;default_value&#xFF0C;&#x4F46;&#x662F;&#x4E24;&#x8005;&#x4E0D;&#x80FD;&#x540C;&#x65F6;&#x8D77;&#x4F5C;&#x7528;&#x3002;</span></span><br><span class="line">        <span class="comment"># &#x5C06;&#x8D85;&#x51FA;&#x7684;&#x53D6;&#x503C;&#x6620;&#x5C04;&#x5230;[len(vocabulary), len(vocabulary) + num_oov_buckets)&#x5185;</span></span><br><span class="line">        <span class="comment"># &#x9ED8;&#x8BA4;&#x53D6;&#x503C;&#x4E3A;0</span></span><br><span class="line">        <span class="comment"># &#x5F53;&#x8BE5;&#x503C;&#x4E0D;&#x4E3A;0&#x65F6;&#xFF0C;default_value&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E3A;-1</span></span><br><span class="line">        <span class="comment"># &#x5F53;default_value&#x548C;num_oov_buckets&#x90FD;&#x53D6;&#x9ED8;&#x8BA4;&#x503C;&#x65F6;&#xFF0C;&#x4F1A;&#x88AB;&#x6620;&#x5C04;&#x4E3A;-1</span></span><br><span class="line">        num_oov_buckets=<span class="number">3</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># feature&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x4E3A;Tensor&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;SparseTensor</span></span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>], [<span class="string">&quot;value3&quot;</span>, <span class="string">&quot;value3&quot;</span>]],</span><br><span class="line">            [[<span class="string">&quot;value3&quot;</span>, <span class="string">&quot;value5&quot;</span>], [<span class="string">&quot;value4&quot;</span>, <span class="string">&quot;value4&quot;</span>]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="comment"># IdWeightPair(id_tensor, weight_tensor)</span></span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sequence_categorical_list_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># &#x7528;&#x6CD5;&#x540C;categorical_column_with_vocabulary_list&#x5B8C;&#x5168;&#x4E00;&#x81F4;</span></span><br><span class="line">    column = tf.feature_column.sequence_categorical_column_with_vocabulary_list(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        vocabulary_list=[<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>, <span class="string">&quot;value3&quot;</span>],</span><br><span class="line">        dtype=tf.string,</span><br><span class="line">        default_value=<span class="number">-1</span>,</span><br><span class="line">        num_oov_buckets=<span class="number">2</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>, <span class="string">&quot;value3&quot;</span>, <span class="string">&quot;value3&quot;</span>],</span><br><span class="line">            [<span class="string">&quot;value3&quot;</span>, <span class="string">&quot;value5&quot;</span>, <span class="string">&quot;value4&quot;</span>, <span class="string">&quot;value4&quot;</span>]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="comment"># IdWeightPair(id_tensor, weight_tensor)</span></span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h2>categorical_column_with_vocabulary_file</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">categorical_file_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># &#x7528;&#x6CD5;&#x540C;categorical_column_with_vocabulary_list</span></span><br><span class="line">    <span class="comment"># &#x533A;&#x522B;&#x5728;&#x4E8E;&#x8FD9;&#x4E2A;&#x4F7F;&#x7528;&#x6587;&#x4EF6;&#x6765;&#x7BA1;&#x7406;&#x53D6;&#x503C;&#x96C6;&#x5408;&#xFF0C;&#x6BCF;&#x4E00;&#x884C;&#x4EE3;&#x8868;&#x4E00;&#x79CD;&#x53D6;&#x503C;&#xFF0C;&#x4F7F;&#x7528;&#x884C;&#x53F7;&#x4F5C;&#x4E3A;&#x6620;&#x5C04;&#x503C;</span></span><br><span class="line">    column = tf.feature_column.categorical_column_with_vocabulary_file(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        vocabulary_file=<span class="string">&quot;path/valuelist&quot;</span>,</span><br><span class="line">        dtype=tf.string,</span><br><span class="line">        default_value=<span class="number">-1</span>,</span><br><span class="line">        num_oov_buckets=<span class="number">3</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># feature&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x4E3A;Tensor&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;SparseTensor</span></span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.SparseTensor(</span><br><span class="line">            indices=[</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br><span class="line">            ],</span><br><span class="line">            values=[<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>, <span class="string">&quot;value3&quot;</span>, <span class="string">&quot;value4&quot;</span>, <span class="string">&quot;value1&quot;</span>],</span><br><span class="line">            dense_shape=[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">        )</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sequence_categorical_file_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># &#x7528;&#x6CD5;&#x540C;categorical_column_with_vocabulary_file&#x5B8C;&#x5168;&#x4E00;&#x81F4;</span></span><br><span class="line">    column = tf.feature_column.sequence_categorical_column_with_vocabulary_file(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        vocabulary_file=<span class="string">&quot;path/valuelist&quot;</span>,</span><br><span class="line">        dtype=tf.string,</span><br><span class="line">        default_value=<span class="number">-1</span>,</span><br><span class="line">        num_oov_buckets=<span class="number">3</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>], [<span class="string">&quot;value3&quot;</span>, <span class="string">&quot;value3&quot;</span>]],</span><br><span class="line">            [[<span class="string">&quot;value3&quot;</span>, <span class="string">&quot;value5&quot;</span>], [<span class="string">&quot;value4&quot;</span>, <span class="string">&quot;value4&quot;</span>]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h2>categorical_column_with_identity</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">categorical_identity_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># &#x5982;&#x679C;&#x7279;&#x5F81;&#x7C7B;&#x578B;&#x4E3A;integer&#xFF0C;&#x5E76;&#x4E14;&#x53D6;&#x503C;&#x5728;[0, num_buckets)&#x4E4B;&#x95F4;</span></span><br><span class="line">    <span class="comment"># &#x7B49;&#x4EF7;&#x4E8E;categorical_column_with_vocabulary_list&#x4E2D;&#x7684;list&#x4E3A;[0 ~ num_bucket)</span></span><br><span class="line">    column = tf.feature_column.categorical_column_with_identity(</span><br><span class="line">        key=<span class="string">&apos;feature&apos;</span>,</span><br><span class="line">        <span class="comment"># &#x53D6;&#x503C;&#x8303;&#x56F4;&#x4E3A;[0, num_buckets)</span></span><br><span class="line">        num_buckets=<span class="number">10</span>,</span><br><span class="line">        <span class="comment"># &#x6570;&#x636E;&#x4E0D;&#x5728;[0, num_buckets)&#x5185;&#x65F6;&#xFF0C;&#x5C06;&#x88AB;&#x6620;&#x5C04;&#x7684;&#x503C;&#x3002;</span></span><br><span class="line">        <span class="comment"># &#x9ED8;&#x8BA4;&#x4E3A;None&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F53;&#x5B58;&#x5728;&#x672A;&#x77E5;&#x6570;&#x636E;&#xFF0C;&#x4F1A;&#x62A5;&#x9519;&#x3002;</span></span><br><span class="line">        <span class="comment"># &#x8981;&#x6C42;default_value&#x7684;&#x53D6;&#x503C;&#x5728;[0, num_buckets)&#x5185;</span></span><br><span class="line">        default_value=<span class="number">3</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># feature&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x4E3A;Tensor&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;SparseTensor</span></span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">            [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>],</span><br><span class="line">            [<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sequence_categorical_identity_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># &#x7528;&#x6CD5;&#x540C;categorical_column_with_identity&#x5B8C;&#x5168;&#x4E00;&#x81F4;</span></span><br><span class="line">    column = tf.feature_column.sequence_categorical_column_with_identity(</span><br><span class="line">        key=<span class="string">&apos;feature&apos;</span>,</span><br><span class="line">        num_buckets=<span class="number">10</span>,</span><br><span class="line">        default_value=<span class="number">3</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]],</span><br><span class="line">            [[<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>], [<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]],</span><br><span class="line">            [[<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>], [<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h2>categorical_column_with_hash_bucket</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">categorical_hash_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># &#x5982;&#x679C;&#x7279;&#x5F81;&#x53D6;&#x503C;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x65E0;&#x6CD5;&#x5168;&#x90E8;&#x7F57;&#x5217;&#x51FA;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;hash&#x6620;&#x5C04;&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="comment"># &#x8FD9;&#x91CC;&#x4F1A;&#x5C06;&#x53D6;&#x503C;&#x7ECF;&#x8FC7;hash&#x4E4B;&#x540E;&#xFF0C;&#x6620;&#x5C04;&#x5230;[0, hash_bucket_size)&#x5185;</span></span><br><span class="line">    column = tf.feature_column.categorical_column_with_hash_bucket(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        <span class="comment"># hash&#x7684;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;</span></span><br><span class="line">        hash_bucket_size=<span class="number">5000</span>,</span><br><span class="line">        <span class="comment"># &#x53EA;&#x652F;&#x6301;string&#x548C;integer</span></span><br><span class="line">        <span class="comment"># &#x6570;&#x503C;&#x7C7B;&#x578B;&#x4E5F;&#x662F;&#x8FDB;&#x884C;hash&#x6620;&#x5C04;</span></span><br><span class="line">        dtype=tf.string)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># feature&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x4E3A;Tensor&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;SparseTensor</span></span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[[<span class="string">&quot;value1&quot;</span>], [<span class="string">&quot;value2&quot;</span>]], [[<span class="string">&quot;value3&quot;</span>], [<span class="string">&quot;value3&quot;</span>]]],</span><br><span class="line">            [[[<span class="string">&quot;value3&quot;</span>], [<span class="string">&quot;value5&quot;</span>]], [[<span class="string">&quot;value4&quot;</span>], [<span class="string">&quot;value4&quot;</span>]]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sequence_categorical_hash_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># &#x7528;&#x6CD5;&#x540C;categorical_column_with_hash_bucket&#x5B8C;&#x5168;&#x4E00;&#x81F4;</span></span><br><span class="line">    column = tf.feature_column.sequence_categorical_column_with_hash_bucket(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        hash_bucket_size=<span class="number">5000</span>,</span><br><span class="line">        dtype=tf.string)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[[<span class="string">&quot;value1&quot;</span>], [<span class="string">&quot;value2&quot;</span>]], [[<span class="string">&quot;value3&quot;</span>], [<span class="string">&quot;value3&quot;</span>]]],</span><br><span class="line">            [[[<span class="string">&quot;value3&quot;</span>], [<span class="string">&quot;value5&quot;</span>]], [[<span class="string">&quot;value4&quot;</span>], [<span class="string">&quot;value4&quot;</span>]]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h2>crossed_column</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cross_column</span><span class="params">()</span>:</span></span><br><span class="line">    column = tf.feature_column.crossed_column(</span><br><span class="line">        <span class="comment"># &#x53EA;&#x652F;&#x6301;2-D&#x7279;&#x5F81;&#xFF08;&#x5305;&#x542B;batch&#x7EF4;&#x5EA6;&#xFF09;</span></span><br><span class="line">        <span class="comment"># key&#x7684;&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x4E3A;string&#x6216;&#x8005;CategoricalColumn&#xFF08;&#x4E0D;&#x652F;&#x6301;HashCategoricalColumn&#xFF09;</span></span><br><span class="line">        keys=[<span class="string">&quot;feature1&quot;</span>, <span class="string">&quot;feature2&quot;</span>],</span><br><span class="line">        hash_bucket_size=<span class="number">1000</span>,</span><br><span class="line">        <span class="comment"># FingerprintCat64&#x5BF9;&#x7279;&#x5F81;&#x8FDB;&#x884C;hash&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x4E2A;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x503C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;</span></span><br><span class="line">        <span class="comment"># integer&#x7C7B;&#x578B;</span></span><br><span class="line">        hash_key=<span class="literal">None</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># feature&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x4E3A;Tensor&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;SparseTensor</span></span><br><span class="line">        <span class="comment"># &#x53EA;&#x5BF9;&#x6709;&#x503C;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x4EA4;&#x53C9;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x4E24;&#x6761;&#x8BB0;&#x5F55;&#x7684;&#x4EA4;&#x53C9;&#x4E2A;&#x6570;&#x5206;&#x522B;&#x4E3A;12&#x548C;9</span></span><br><span class="line">        <span class="string">&quot;feature1&quot;</span>: tf.constant(value=[</span><br><span class="line">            [<span class="string">&quot;value11&quot;</span>, <span class="string">&quot;value12&quot;</span>, <span class="string">&quot;value13&quot;</span>],</span><br><span class="line">            [<span class="string">&quot;value11&quot;</span>, <span class="string">&quot;value11&quot;</span>, <span class="string">&quot;value14&quot;</span>]</span><br><span class="line">        ]),</span><br><span class="line">        <span class="string">&quot;feature2&quot;</span>: tf.SparseTensor(</span><br><span class="line">            <span class="comment"># indices&#x8981;&#x6309;&#x987A;&#x5E8F;&#x5199;</span></span><br><span class="line">            indices=[</span><br><span class="line">                [<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">3</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">5</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">6</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">4</span>]</span><br><span class="line">            ], </span><br><span class="line">            values=[<span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4.</span>, <span class="number">4</span>], </span><br><span class="line">            dense_shape=[<span class="number">2</span>, <span class="number">7</span>])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h2>weighted_categorical_column</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">weighted_column</span><span class="params">()</span>:</span></span><br><span class="line">    sub_categorical_column = tf.feature_column.categorical_column_with_identity(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        num_buckets=<span class="number">5</span>,</span><br><span class="line">        default_value=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># &#x6CA1;&#x6709;key&#x548C;weight&#x957F;&#x5EA6;&#x7684;&#x5339;&#x914D;&#x5224;&#x65AD;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x4E24;&#x8005;&#x6700;&#x7EC8;&#x8F93;&#x51FA;&#x7684;shape&#x53EF;&#x80FD;&#x4E0D;&#x4E00;&#x81F4;</span></span><br><span class="line">    <span class="comment"># &#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;key&#x548C;weight&#x90FD;&#x662F;SparseTensor</span></span><br><span class="line">    column = tf.feature_column.weighted_categorical_column(</span><br><span class="line">        <span class="comment"># &#x8FD9;&#x4E2A;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;sequence&#x5217;&#xFF0C;&#x4F46;&#x662F;&#x4E24;&#x8005;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x81F4;&#x7684;</span></span><br><span class="line">        categorical_column=sub_categorical_column,</span><br><span class="line">        weight_feature_key=<span class="string">&quot;feature_weight&quot;</span>,</span><br><span class="line">        <span class="comment"># &#x7C7B;&#x578B;&#x53EA;&#x80FD;&#x4E3A;integer&#x6216;float</span></span><br><span class="line">        <span class="comment"># &#x9700;&#x8981;&#x4FDD;&#x6301;&#x548C;weight_feature_key&#x7279;&#x5F81;&#x7684;&#x5339;&#x914D;</span></span><br><span class="line">        <span class="comment"># &#x4E0D;&#x8FC7;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;weight_tensor&#x4E5F;&#x4F1A;&#x88AB;&#x5F3A;&#x5236;&#x8F6C;&#x6210;float32</span></span><br><span class="line">        dtype=tf.float32)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># weighted column&#x53EA;&#x662F;&#x5C06;&#x4E24;&#x5217;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x5217;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x4E24;&#x5217;&#x7684;&#x5173;&#x7CFB;&#x505A;&#x5177;&#x4F53;&#x9650;&#x5236;</span></span><br><span class="line">        <span class="comment"># &#x6240;&#x4EE5;&#x5177;&#x4F53;key&#x548C;value&#x7684;&#x8F93;&#x5165;&#x8981;&#x6C42;&#x4E0E;&#x539F;&#x59CB;column&#x4E00;&#x81F4;</span></span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[[<span class="number">1</span>, <span class="number">2</span>]], [[<span class="number">3</span>, <span class="number">4</span>]], [[<span class="number">5</span>, <span class="number">5</span>]]],</span><br><span class="line">            [[[<span class="number">9</span>, <span class="number">8</span>]], [[<span class="number">7</span>, <span class="number">6</span>]], [[<span class="number">5</span>, <span class="number">4</span>]]]</span><br><span class="line">        ]),</span><br><span class="line">        <span class="string">&quot;feature_weight&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>, <span class="number">4.4</span>, <span class="number">5.5</span>, <span class="number">6.6</span>]],</span><br><span class="line">            [[<span class="number">9.9</span>, <span class="number">8.8</span>, <span class="number">7.7</span>, <span class="number">6.6</span>, <span class="number">5.5</span>, <span class="number">4.4</span>]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h1>DenseColumn&#x7CFB;&#x5217;</h1>
<p><code>DenseColumn</code>&#x6D3E;&#x751F;&#x51FA;&#x7684;&#x65B9;&#x6CD5;&#x53EA;&#x6709;<code>numeric_column</code>&#xFF0C;&#x5C31;&#x662F;&#x7B80;&#x5355;&#x7684;&#x83B7;&#x5F97;&#x8F93;&#x5165;&#x7684;&#x8FDE;&#x7EED;&#x7279;&#x5F81;&#x6570;&#x636E;&#x3002;</p>
<h2>DenseColumn&#x81EA;&#x5B9A;&#x4E49;&#x65B9;&#x6CD5;</h2>
<h3>get_dense_tensor(transformation_cache, state_manager)</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;Tensor&#xFF0C;&#x8868;&#x793A;&#x7684;&#x5C31;&#x662F;&#x6700;&#x7EC8;&#x8F93;&#x51FA;&#x7684;&#x8FDE;&#x7EED;&#x7279;&#x5F81;&#x6570;&#x636E;&#x3002;</p>
<h3>variable_shape()</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;TensorShape&#xFF0C;&#x8868;&#x793A;<code>get_dense_tensor</code>&#x8FD4;&#x56DE;&#x503C;&#x7684;shape&#x5927;&#x5C0F;&#xFF08;&#x4E0D;&#x5305;&#x542B;batch&#x7EF4;&#x5EA6;&#xFF09;&#x3002;</p>
<h2>numeric_column</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numeric_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># shape, default_value, dtype&#x4E00;&#x8D77;&#x5B9A;&#x4E49;&#x4E86;&#x7279;&#x5F81;&#x5217;&#x89E3;&#x6790;&#x89C4;&#x5219;</span></span><br><span class="line">    <span class="comment"># tf.io.FixedLenFeature(shape, default_value, dtype)</span></span><br><span class="line">    <span class="comment"># &#x5982;&#x679C;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x81EA;&#x5DF1;&#x6307;&#x5B9A;&#x7279;&#x5F81;&#x89E3;&#x6790;&#x89C4;&#x5219;&#xFF0C;&#x8FD9;&#x51E0;&#x4E2A;&#x53C2;&#x6570;&#x5C31;&#x6CA1;&#x5565;&#x7528;</span></span><br><span class="line">    column = tf.feature_column.numeric_column(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        shape=(<span class="number">5</span>,),</span><br><span class="line">        default_value=<span class="number">0</span>,</span><br><span class="line">        <span class="comment"># &#x7C7B;&#x578B;&#x4E3A;integer&#x6216;&#x8005;float</span></span><br><span class="line">        dtype=tf.float32,</span><br><span class="line">        <span class="comment"># &#x6570;&#x503C;&#x90FD;&#x4F1A;&#x6267;&#x884C;&#x8BE5;&#x65B9;&#x6CD5;&#x8F6C;&#x5316;&#x4E4B;&#x540E;&#x518D;&#x8FD4;&#x56DE;</span></span><br><span class="line">        <span class="comment"># &#x5BF9;&#x4E8E;&#x7F3A;&#x5931;&#x503C;&#x4F1A;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;default_value</span></span><br><span class="line">        normalizer_fn=<span class="keyword">lambda</span> x: x / <span class="number">6</span>)</span><br><span class="line">    <span class="comment"># &#x6CE8;&#x610F;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x8F93;&#x5165;&#x7684;&#x6570;&#x636E;&#x548C;&#x4E0A;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x89E3;&#x6790;&#x89C4;&#x5219;&#x5E76;&#x4E0D;&#x4E00;&#x81F4;&#x3002;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x4E0D;&#x4F1A;&#x51FA;&#x9519;</span></span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># feature&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x5FC5;&#x987B;&#x4E3A;Tensor</span></span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]],</span><br><span class="line">            [[<span class="number">7</span>, <span class="number">8</span>], [<span class="number">9</span>, <span class="number">10</span>], [<span class="number">11</span>, <span class="number">12</span>]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_dense_tensor(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h1>SequenceDenseColumn&#x7CFB;&#x5217;</h1>
<p>&#x8FD9;&#x4E2A;&#x662F;DenseColumn&#x7684;&#x5E8F;&#x5217;&#x5F62;&#x5F0F;&#x3002;&#x5E8F;&#x5217;&#x6570;&#x636E;&#x662F;&#x5141;&#x8BB8;&#x6709;&#x7F3A;&#x5931;&#x503C;&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;SequenceDenseColumn&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x5FC5;&#x987B;&#x662F;SparseTensor&#x3002;&#x800C;DenseColumn&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x5FC5;&#x987B;&#x662F;Tensor&#x3002;</p>
<h2>SequenceDenseColumn&#x81EA;&#x5B9A;&#x4E49;&#x65B9;&#x6CD5;</h2>
<h3>get_sequence_dense_tensor(transformation_cache, state_manager)</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;TensorSequenceLengthPair(dense_tensor, sequence_length)&#x3002;dense_tensor&#x662F;&#x5E8F;&#x5217;&#x6570;&#x636E;&#x7684;Tensor&#x683C;&#x5F0F;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x5BF9;&#x4E8E;&#x7F3A;&#x5931;&#x7684;&#x503C;&#x4F1A;&#x8FDB;&#x884C;default_value&#x586B;&#x5145;&#x3002;sequence_length&#x662F;&#x8BB0;&#x5F55;&#x6BCF;&#x4E2A;batch&#x5E8F;&#x5217;&#x957F;&#x5EA6;&#x7684;Tensor&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x5E8F;&#x5217;&#x957F;&#x5EA6;&#x662F;&#x4E0D;&#x5305;&#x62EC;&#x6700;&#x540E;&#x8FDE;&#x7EED;&#x586B;&#x5145;&#x7684;&#x957F;&#x5EA6;&#x3002;</p>
<h2>sequence_numeric_column</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sequence_numeric_column</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># &#x7528;&#x6CD5;&#x540C;numeric_column&#x57FA;&#x672C;&#x4E00;&#x81F4;</span></span><br><span class="line">    <span class="comment"># &#x533A;&#x522B;&#x5728;&#x4E8E;&#x4E24;&#x8005;&#x8F93;&#x5165;&#x6570;&#x636E;&#x7684;&#x683C;&#x5F0F;&#x8981;&#x6C42;&#x4E0D;&#x540C;&#xFF1A;&#x8FD9;&#x4E2A;&#x53EA;&#x5141;&#x8BB8;&#x8F93;&#x5165;SparseTensor&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x53EA;&#x5141;&#x8BB8;&#x8F93;&#x5165;Tensor</span></span><br><span class="line">    <span class="comment"># &#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8F93;&#x5165;&#x662F;SparseTensor&#xFF0C;&#x6240;&#x4EE5;shape&#x53C2;&#x6570;&#x662F;&#x6709;&#x610F;&#x4E49;&#x7684;</span></span><br><span class="line">    column = tf.feature_column.sequence_numeric_column(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        <span class="comment"># shape&#x6307;&#x5B9A;&#x5E8F;&#x5217;&#x4E2D;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x5F62;&#x72B6;</span></span><br><span class="line">        <span class="comment"># &#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7ED3;&#x6784;&#x7684;&#x5F62;&#x72B6;&#x4E3A;[batch_size, element_count/sum(shape[:]) ,shape]</span></span><br><span class="line">        <span class="comment"># &#x8BE5;&#x503C;&#x7684;&#x8BBE;&#x7F6E;&#x53EA;&#x4F1A;&#x5F71;&#x54CD;dense_tensor&#x3002;sequence_length&#x53EA;&#x548C;&#x5B9E;&#x9645;&#x8F93;&#x5165;&#x6570;&#x636E;&#x6709;&#x5173;</span></span><br><span class="line">        shape=(<span class="number">3</span>,),</span><br><span class="line">        default_value=<span class="number">60</span>,</span><br><span class="line">        dtype=tf.float32,</span><br><span class="line">        normalizer_fn=<span class="keyword">lambda</span> x: x / <span class="number">6</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># feature&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x5FC5;&#x987B;&#x4E3A;SparseTensor</span></span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.SparseTensor(</span><br><span class="line">            <span class="comment"># indices&#x8981;&#x6309;&#x987A;&#x5E8F;&#x5199;</span></span><br><span class="line">            indices=[</span><br><span class="line">                [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">5</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line">            ], </span><br><span class="line">            values=[<span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4.</span>, <span class="number">4</span>], </span><br><span class="line">            dense_shape=[<span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sequence_dense_tensor(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h1>CategoricalColumn X DenseColumn &#x7CFB;&#x5217;</h1>
<p>&#x8BE5;&#x7CFB;&#x5217;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;<code>bucketized_column</code>&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x4F20;&#x5165;&#x4E00;&#x4E2A;<code>1-D</code>&#x7684;<code>NumericColumn</code>&#xFF08;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x80AF;&#x5B9A;&#x662F;&#x4E0D;&#x652F;&#x6301;<code>SequenceNumericColumn</code>&#x7684;&#xFF09;&#x3002;<br>
&#x5176;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x5229;&#x7528;<code>boundaries</code>&#xFF0C;&#x5C06;&#x6570;&#x503C;&#x7279;&#x5F81;&#x8FDB;&#x884C;&#x79BB;&#x6563;&#x5316;&#x3002;<br>
&#x4F8B;&#x5982;&#xFF0C;<code>boundaries=[3, 5, 7, 10]</code>&#xFF0C;&#x5C31;&#x4F1A;&#x5F97;&#x5230;&#x4E0B;&#x8868;&#x7684;&#x6620;&#x5C04;&#x89C4;&#x5219;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:center">&#x89C4;&#x5219;</th>
<th style="text-align:center">&#x6620;&#x5C04;&#x503C;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">x &lt; 3</td>
<td style="text-align:center">1 0 0 0 0</td>
</tr>
<tr>
<td style="text-align:center">3 &lt;= x &lt; 5</td>
<td style="text-align:center">0 1 0 0 0</td>
</tr>
<tr>
<td style="text-align:center">5 &lt;= x &lt; 7</td>
<td style="text-align:center">0 0 1 0 0</td>
</tr>
<tr>
<td style="text-align:center">7 &lt;= x &lt; 10</td>
<td style="text-align:center">0 0 0 1 0</td>
</tr>
<tr>
<td style="text-align:center">10 &lt;= x</td>
<td style="text-align:center">0 0 0 0 1</td>
</tr>
</tbody>
</table>
<h2>bucketized_column&#x7684;&#x4E24;&#x4E2A;&#x8F93;&#x51FA;&#x65B9;&#x6CD5;</h2>
<h3>get_dense_tensor(transformation_cache, state_manager)</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x4ECE;<code>DenseColumn</code>&#x7EE7;&#x627F;&#x6765;&#x7684;&#x3002;&#x8FD4;&#x56DE;&#x7684;&#x503C;&#x662F;&#x6BCF;&#x4E2A;&#x6570;&#x503C;&#x901A;&#x8FC7;&#x6620;&#x5C04;&#x4E4B;&#x540E;&#x7684;one-hot&#x7684;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#xFF0C;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x6620;&#x5C04;&#x89C4;&#x5219;&#x4E2D;&#x7684;&#x6620;&#x5C04;&#x503C;&#x3002;</p>
<h3>get_sparse_tensors(transformation_cache, state_manager)</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x4ECE;<code>CategoricalColumn</code>&#x7EE7;&#x627F;&#x6765;&#x7684;&#x3002;&#x8FD4;&#x56DE;&#x7684;&#x503C;&#x662F;<code>get_dense_tensor</code>&#x7684;&#x8F93;&#x51FA;&#x5728;&#x6BCF;&#x4E2A;<code>batch</code>&#x505A;<code>flatten</code>&#x4E4B;&#x540E;<code>one-hot</code>&#x7F16;&#x7801;&#x7684;<code>SparseTensor</code>&#x683C;&#x5F0F;&#x3002;</p>
<h2>bucketized_column</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bucketized_column</span><span class="params">()</span>:</span></span><br><span class="line">    numeric_column = tf.feature_column.numeric_column(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        shape=<span class="number">6</span>,</span><br><span class="line">        default_value=<span class="number">0</span>,</span><br><span class="line">        dtype=tf.float32)</span><br><span class="line">    column = tf.feature_column.bucketized_column(</span><br><span class="line">        <span class="comment"># 1-D&#x7684;numeric column</span></span><br><span class="line">        source_column=numeric_column,</span><br><span class="line">        <span class="comment"># &#x8981;&#x6C42;&#x5217;&#x8868;&#x4E3A;&#x5347;&#x5E8F;</span></span><br><span class="line">        boundaries=[<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">10</span>])</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="comment"># &#x7531;&#x4E8E;&#x8F93;&#x5165;&#x662F;&#x4ECE;NumericColumn&#x8FDB;&#x5165;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x6C42;&#x5FC5;&#x987B;&#x4E3A;Tensor</span></span><br><span class="line">        <span class="comment"># &#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x8F93;&#x5165;&#x5E76;&#x4E0D;&#x662F;1-D&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</span></span><br><span class="line">        <span class="comment"># get_dense_tensor&#x8FD4;&#x56DE;&#x503C;&#x4E2D;&#x5305;&#x542B;&#x8F93;&#x5165;&#x7684;shape&#x4FE1;&#x606F;</span></span><br><span class="line">        <span class="comment"># get_sparse_tensors&#x4F1A;&#x5BF9;&#x8F93;&#x5165;&#x6570;&#x636E;&#x8FDB;&#x884C;flatten&#x64CD;&#x4F5C;</span></span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]],</span><br><span class="line">            [[<span class="number">7</span>, <span class="number">7</span>], [<span class="number">9</span>, <span class="number">10</span>], [<span class="number">11</span>, <span class="number">12</span>]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    dense_tensor = column.get_dense_tensor(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br><span class="line">    sparse_tensors = column.get_sparse_tensors(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> dense_tensor, sparse_tensors</span><br></pre></td></tr></table></figure>
<h1>DenseColumn X SequenceDenseColumn &#x7CFB;&#x5217;</h1>
<p>&#x8BE5;&#x7CFB;&#x5217;&#x4E0B;&#x7684;&#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x5229;&#x7528;<code>CategoricalColumn</code>&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#x6570;&#x636E;&#x7684;&#x5165;&#x53E3;&#x3002;&#x7531;&#x4E8E;&#x7EE7;&#x627F;&#x4E86;<code>DenseColumn</code>&#x548C;<code>SequenceDenseColumn</code>&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x975E;&#x5E8F;&#x5217;&#x548C;&#x5E8F;&#x5217;&#x7279;&#x5F81;&#x90FD;&#x662F;&#x652F;&#x6301;&#x7684;&#x3002;<br>
&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;<code>get_dense_tensor</code>&#x548C;<code>get_sequence_dense_tensor</code>&#x5728;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x770B;&#x4F20;&#x5165;&#x7684;<code>CategoricalColumn</code>&#x662F;&#x54EA;&#x4E00;&#x79CD;&#x3002;<br>
&#x5982;&#x679C;&#x4F7F;&#x7528;<code>categorical_*</code>&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x7684;<code>CategoricalColumn</code>&#xFF0C;&#x9700;&#x8981;&#x8C03;&#x7528;<code>get_dense_tensor</code>&#x3002;<br>
&#x5982;&#x679C;&#x4F7F;&#x7528;<code>sequence_categorical_*</code>&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x7684;<code>CategoricalColumn</code>&#xFF0C;&#x9700;&#x8981;&#x8C03;&#x7528;<code>get_sequence_dense_tensor</code>&#x3002;<br>
&#x6CE8;&#x610F;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x4E0D;&#x4F1A;&#x540C;&#x65F6;&#x8BF7;&#x4F5C;&#x7528;&#x3002;</p>
<h2>indicator_column&#x7684;&#x4E24;&#x4E2A;&#x8F93;&#x51FA;&#x65B9;&#x6CD5;</h2>
<h3>get_dense_tensor(transformation_cache, state_manager)</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x4ECE;<code>DenseColumn</code>&#x7EE7;&#x627F;&#x6765;&#x7684;&#x3002;&#x8FD4;&#x56DE;&#x503C;&#x8BA1;&#x7B97;&#x7684;&#x5177;&#x4F53;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x901A;&#x8FC7;<code>CategoricalColumn</code>&#x83B7;&#x5F97;&#x8F93;&#x5165;&#x6570;&#x636E;&#x7684;&#x6620;&#x5C04;&#x503C;&#xFF0C;&#x5F97;&#x5230;&#x4E00;&#x4E2A;<code>shape=[a,b,c,d]</code>&#x7684;<code>SparseTensor</code></li>
<li>&#x6839;&#x636E;<code>CategoricalColumn</code>&#x7684;<code>num_buckets=N</code>&#x503C;&#xFF0C;&#x5C06;&#x4E0A;&#x9762;&#x7684;<code>SparseTensor</code>&#x8F6C;&#x6210;<code>shape=[a,b,c,d,N]</code>&#x7684;<code>Tensor</code></li>
<li>&#x5C06;&#x4E0A;&#x9762;&#x7684;<code>Tensor</code>&#x4EE5;<code>shape[-2]</code>&#x4E3A;&#x805A;&#x5408;&#x7EF4;&#x5EA6;&#x8FDB;&#x884C;<code>reduce_sum</code>&#x64CD;&#x4F5C;&#xFF0C;&#x5F97;&#x5230;&#x4E00;&#x4E2A;<code>shape=[a,b,c,N]</code>&#x7684;<code>Tensor</code></li>
<li>&#x8FD4;&#x56DE;&#x4E0A;&#x9762;&#x7684;<code>Tensor</code></li>
</ol>
<h3>get_sequence_dense_tensor(transformation_cache, state_manager)</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x4ECE;<code>SequenceDenseColumn</code>&#x7EE7;&#x627F;&#x6765;&#x7684;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>TensorSequenceLengthPair(dense_tensor, sequence_length)</code>&#x3002;<br>
<code>dense_tensor</code>&#x7684;&#x903B;&#x8F91;&#x548C;<code>get_dense_tensor</code>&#x4E00;&#x6837;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;<code>SequenceColumn</code>&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x6C38;&#x8FDC;&#x662F;<code>3-D</code>&#x7684;&#xFF0C;&#x5206;&#x522B;&#x4E3A;<code>[batch, sequence, element]</code>&#x3002;<br>
<code>sequence_length</code>&#x8BB0;&#x5F55;&#x6BCF;&#x4E2A;<code>batch</code>&#x5E8F;&#x5217;&#x957F;&#x5EA6;&#x7684;<code>Tensor</code>&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x5E8F;&#x5217;&#x957F;&#x5EA6;&#x662F;&#x4E0D;&#x5305;&#x62EC;&#x6700;&#x540E;&#x8FDE;&#x7EED;&#x586B;&#x5145;&#x7684;&#x957F;&#x5EA6;&#x3002;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dense_indicator_column</span><span class="params">()</span>:</span></span><br><span class="line">    categorical_column = tf.feature_column.categorical_column_with_identity(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        num_buckets=<span class="number">5</span>,</span><br><span class="line">        default_value=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># multi-hot&#x7F16;&#x7801;&#xFF0C;&#x51FA;&#x73B0;&#x591A;&#x6B21;&#x7684;&#x76F8;&#x540C;&#x503C;&#xFF0C;&#x4F1A;&#x7D2F;&#x52A0;</span></span><br><span class="line">    column = tf.feature_column.indicator_column(categorical_column=categorical_column)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[[<span class="number">1</span>, <span class="number">2</span>]], [[<span class="number">3</span>, <span class="number">4</span>]], [[<span class="number">5</span>, <span class="number">5</span>]]],</span><br><span class="line">            [[[<span class="number">9</span>, <span class="number">8</span>]], [[<span class="number">7</span>, <span class="number">6</span>]], [[<span class="number">5</span>, <span class="number">4</span>]]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_dense_tensor(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dense_sequence_indicator_column</span><span class="params">()</span>:</span></span><br><span class="line">    sequence_categorical_column = tf.feature_column.sequence_categorical_column_with_identity(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        num_buckets=<span class="number">5</span>,</span><br><span class="line">        default_value=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># &#x5F53;categorical_column&#x4E3A;sequence&#x7C7B;&#x578B;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x4F1A;&#x591A;&#x4E00;&#x4E2A;sequence_length&#xFF0C;&#x5176;&#x4F59;&#x90FD;&#x4E00;&#x6837;</span></span><br><span class="line">    column = tf.feature_column.indicator_column(categorical_column=sequence_categorical_column)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[[<span class="number">1</span>, <span class="number">2</span>]], [[<span class="number">3</span>, <span class="number">4</span>]], [[<span class="number">5</span>, <span class="number">5</span>]]],</span><br><span class="line">            [[[<span class="number">9</span>, <span class="number">8</span>]], [[<span class="number">7</span>, <span class="number">6</span>]], [[<span class="number">5</span>, <span class="number">4</span>]]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> column.get_sequence_dense_tensor(transformation_cache=feature_cache, state_manager=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h2>embedding_column&#x7684;&#x4E24;&#x4E2A;&#x8F93;&#x51FA;&#x65B9;&#x6CD5;</h2>
<p><code>EmbeddingColumn</code>(&#x5305;&#x62EC;&#x540E;&#x9762;&#x7684;<code>SharedEmbeddingColumn</code>)&#x4E0E;&#x524D;&#x9762;&#x7684;<code>Column</code>&#x90FD;&#x4E0D;&#x592A;&#x4E00;&#x6837;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x5177;&#x6709;&#x72B6;&#x6001;&#x7684;<code>Column</code>&#xFF0C;&#x5176;&#x72B6;&#x6001;&#x6570;&#x636E;&#x901A;&#x8FC7;<code>StateManager</code>&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;<br>
&#x8FD9;&#x91CC;&#x6240;&#x8BF4;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x6A21;&#x578B;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x8BAD;&#x7EC3;&#x7684;&#x53C2;&#x6570;&#x3002;<code>FeatureColumn</code>&#x57FA;&#x7C7B;&#x4E2D;&#x6709;&#x4E2A;<code>create_state</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x53C2;&#x6570;&#x521D;&#x59CB;&#x5316;&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5BF9;&#x4E8E;&#x5177;&#x6709;&#x72B6;&#x6001;&#x7684;<code>Column</code>&#xFF0C;&#x9700;&#x8981;&#x8C03;&#x7528;<code>create_state</code>&#x6765;&#x521D;&#x59CB;&#x5316;&#x53C2;&#x6570;&#xFF0C;&#x624D;&#x80FD;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<h3>get_dense_tensor(transformation_cache, state_manager)</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x4ECE;<code>DenseColumn</code>&#x7EE7;&#x627F;&#x6765;&#x7684;&#x3002;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E0A;&#x9762;&#x7684;<code>indicator_column</code>&#x3002;&#x4E24;&#x8005;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#xFF0C;<code>embedding_column</code>&#x76F8;&#x8F83;&#x4E8E;<code>indicator_column</code>&#x4F1A;&#x5728;&#x8FDB;&#x884C;<code>one-hot</code>&#x7F16;&#x7801;&#x4E4B;&#x540E;&#xFF0C;&#x4E0D;&#x4F1A;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x7F16;&#x7801;&#xFF0C;&#x800C;&#x662F;&#x4F1A;&#x5C06;<code>one-hot</code>&#x7F16;&#x7801;&#x548C;<code>StateManager</code>&#x7BA1;&#x7406;&#x7684;&#x5D4C;&#x5165;&#x77E9;&#x9635;&#x8FDB;&#x884C;&#x77E9;&#x9635;&#x76F8;&#x4E58;&#xFF0C;&#x4ECE;&#x800C;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x7A20;&#x5BC6;&#x7684;&#x7EF4;&#x5EA6;&#x4E3A;<code>dimension</code>&#x7684;&#x5411;&#x91CF;&#x3002;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;&#x503C;&#x662F;&#x8FD9;&#x4E2A;&#x7A20;&#x5BC6;&#x7684;&#x5411;&#x91CF;&#x3002;</p>
<h3>get_sequence_dense_tensor(transformation_cache, state_manager)</h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x4ECE;<code>SequenceDenseColumn</code>&#x7EE7;&#x627F;&#x6765;&#x7684;&#x3002;&#x8FD9;&#x4E2A;&#x548C;<code>indicator_column</code>&#x662F;&#x4E00;&#x6837;&#x7684;&#x903B;&#x8F91;&#x3002;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">embedding_column</span><span class="params">()</span>:</span></span><br><span class="line">    categorical_column = tf.feature_column.categorical_column_with_identity(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        num_buckets=<span class="number">5</span>,</span><br><span class="line">        default_value=<span class="number">0</span>)</span><br><span class="line">    weighted_categorical_column = tf.feature_column.weighted_categorical_column(</span><br><span class="line">        categorical_column=categorical_column,</span><br><span class="line">        weight_feature_key=<span class="string">&quot;feature_weights&quot;</span>,</span><br><span class="line">        dtype=tf.float32)</span><br><span class="line">    column = tf.feature_column.embedding_column(</span><br><span class="line">        categorical_column=weighted_categorical_column,</span><br><span class="line">        <span class="comment"># &#x5D4C;&#x5165;&#x6743;&#x91CD;&#x7684;&#x7EF4;&#x5EA6;</span></span><br><span class="line">        dimension=<span class="number">10</span>,</span><br><span class="line">        <span class="comment"># &#x51FA;&#x73B0;&#x6B21;&#x6570;&#x591A;&#x6B21;&#x7684;&#x503C;&#x5BF9;&#x5E94;&#x6743;&#x91CD;&#x7684;&#x805A;&#x5408;&#x65B9;&#x5F0F;</span></span><br><span class="line">        <span class="comment"># &#x5305;&#x62EC;sum&#xFF08;&#x52A0;&#x6743;&#x548C;&#xFF09;&#x3001;mean&#xFF08;&#x52A0;&#x6743;&#x548C;/&#x603B;&#x6743;&#x91CD;&#xFF09;&#x3001;sqrtn&#xFF08;&#x52A0;&#x6743;&#x548C;/&#x6743;&#x91CD;&#x5E73;&#x65B9;&#x548C;&#x7684;&#x5E73;&#x65B9;&#x6839;&#xFF09;</span></span><br><span class="line">        combiner=<span class="string">&quot;sqrtn&quot;</span>,</span><br><span class="line">        <span class="comment"># &#x6743;&#x91CD;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;</span></span><br><span class="line">        initializer=tf.initializers.ones,</span><br><span class="line">        <span class="comment"># &#x6307;&#x5B9A;&#x4ECE;checkpoint&#x6587;&#x4EF6;&#x91CC;&#x52A0;&#x8F7D;&#x6743;&#x91CD;&#x503C;&#x7684;&#x6587;&#x4EF6;&#x5730;&#x5740;</span></span><br><span class="line">        ckpt_to_load_from=<span class="literal">None</span>,</span><br><span class="line">        <span class="comment"># checkpoint&#x4E2D;&#x7279;&#x5F81;&#x5BF9;&#x5E94;&#x7684;&#x540D;&#x79F0;</span></span><br><span class="line">        tensor_name_in_ckpt=<span class="literal">None</span>,</span><br><span class="line">        <span class="comment"># &#x8FD9;&#x4E2A;&#x503C;&#x53C2;&#x89C1;&#xFF1A;tf.clip_by_norm(tensor, max_norm)</span></span><br><span class="line">        max_norm=<span class="literal">None</span>,</span><br><span class="line">        <span class="comment"># &#x6743;&#x91CD;&#x662F;&#x5426;&#x9700;&#x8981;&#x8BAD;&#x7EC3;</span></span><br><span class="line">        trainable=<span class="literal">True</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[[<span class="number">1</span>, <span class="number">2</span>]], [[<span class="number">3</span>, <span class="number">4</span>]], [[<span class="number">5</span>, <span class="number">5</span>]]],</span><br><span class="line">            [[[<span class="number">9</span>, <span class="number">8</span>]], [[<span class="number">7</span>, <span class="number">6</span>]], [[<span class="number">5</span>, <span class="number">4</span>]]]</span><br><span class="line">        ]),</span><br><span class="line">        <span class="string">&quot;feature_weights&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>, <span class="number">4.4</span>, <span class="number">5.5</span>, <span class="number">6.6</span>]],</span><br><span class="line">            [[<span class="number">9.9</span>, <span class="number">8.8</span>, <span class="number">7.7</span>, <span class="number">6.6</span>, <span class="number">5.5</span>, <span class="number">4.4</span>]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    state_manager = feature_column_v2._StateManagerImplV2(layer=tf.keras.layers.Layer(), trainable=<span class="literal">True</span>)</span><br><span class="line">    column.create_state(state_manager=state_manager)</span><br><span class="line">    <span class="keyword">return</span> column.get_dense_tensor(transformation_cache=feature_cache, state_manager=state_manager)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sequence_embedding_column</span><span class="params">()</span>:</span></span><br><span class="line">    sequence_categorical_column = tf.feature_column.sequence_categorical_column_with_identity(</span><br><span class="line">        key=<span class="string">&quot;feature&quot;</span>,</span><br><span class="line">        num_buckets=<span class="number">5</span>,</span><br><span class="line">        default_value=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># &#x7528;&#x6CD5;&#x548C;&#x4E0A;&#x9762;&#x7684;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#xFF0C;&#x533A;&#x522B;&#x5728;&#x4E8E;sequence&#x7684;&#x7279;&#x5F81;&#x5217;&#x5728;&#x8FD4;&#x56DE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x591A;&#x4E00;&#x4E2A;sequence_length</span></span><br><span class="line">    <span class="comment"># &#x76EE;&#x524D;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x5E26;&#x6743;SequenceCategoricalColumn&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x53EA;&#x80FD;&#x652F;&#x6301;&#x4E0D;&#x5E26;&#x6743;&#x7684;CategoricalColumn</span></span><br><span class="line">    column = tf.feature_column.embedding_column(</span><br><span class="line">        categorical_column=sequence_categorical_column,</span><br><span class="line">        dimension=<span class="number">10</span>,</span><br><span class="line">        combiner=<span class="string">&quot;mean&quot;</span>,</span><br><span class="line">        initializer=tf.initializers.glorot_normal,</span><br><span class="line">        ckpt_to_load_from=<span class="literal">None</span>,</span><br><span class="line">        tensor_name_in_ckpt=<span class="literal">None</span>,</span><br><span class="line">        max_norm=<span class="literal">None</span>,</span><br><span class="line">        trainable=<span class="literal">True</span>)</span><br><span class="line">    feature_cache = feature_column_lib.FeatureTransformationCache(features={</span><br><span class="line">        <span class="string">&quot;feature&quot;</span>: tf.constant(value=[</span><br><span class="line">            [[[<span class="number">1</span>, <span class="number">2</span>]], [[<span class="number">3</span>, <span class="number">4</span>]], [[<span class="number">5</span>, <span class="number">5</span>]]],</span><br><span class="line">            [[[<span class="number">9</span>, <span class="number">8</span>]], [[<span class="number">7</span>, <span class="number">6</span>]], [[<span class="number">5</span>, <span class="number">4</span>]]]</span><br><span class="line">        ])</span><br><span class="line">    })</span><br><span class="line">    state_manager = feature_column_v2._StateManagerImplV2(layer=tf.keras.layers.Layer(), trainable=<span class="literal">True</span>)</span><br><span class="line">    column.create_state(state_manager=state_manager)</span><br><span class="line">    <span class="keyword">return</span> column.get_sequence_dense_tensor(transformation_cache=feature_cache, state_manager=state_manager)</span><br></pre></td></tr></table></figure>
<h2>shared_embedding_column</h2>
<p>&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x4E0E;<code>EmbeddingColumn</code>&#x76F8;&#x540C;&#x3002;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;<code>CategoricalColumn</code>&#x5217;&#x8868;&#xFF0C;&#x5F97;&#x5230;&#x4E00;&#x4E2A;<code>EmbeddingColumn</code>&#x7684;&#x5217;&#x8868;&#x3002;&#x8FD9;&#x4E2A;&#x5217;&#x8868;&#x4E2D;&#x7684;<code>EmbeddingColumn</code>&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4EFD;&#x5D4C;&#x5165;&#x5411;&#x91CF;&#x3002;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.feature_column <span class="keyword">import</span> feature_column_lib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shared_embedding_column</span><span class="params">()</span>:</span></span><br><span class="line">    column1 = ...</span><br><span class="line">    column2 = ...</span><br><span class="line">    <span class="comment"># &#x7528;&#x6CD5;&#x548C;embedding_columns&#x57FA;&#x672C;&#x4E00;&#x81F4;</span></span><br><span class="line">    columns = tf.feature_column.shared_embeddings(</span><br><span class="line">        <span class="comment"># &#x8981;&#x6C42;&#x5217;&#x8868;&#x91CC;&#x7684;&#x7279;&#x5F81;&#x5217;&#xFF0C;&#x9664;&#x4E86;&#x7279;&#x5F81;&#x540D;&#x79F0;&#xFF0C;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;</span></span><br><span class="line">        categorical_columns=[column1, column2],</span><br><span class="line">        <span class="comment"># &#x6307;&#x5B9A;&#x5171;&#x4EAB;&#x5D4C;&#x5165;&#x5411;&#x91CF;&#x7684;&#x96C6;&#x5408;&#x540D;&#x79F0;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E0D;&#x6307;&#x5B9A;&#x4F1A;&#x63D0;&#x4F9B;&#x9ED8;&#x8BA4;&#x503C;</span></span><br><span class="line">        shared_embedding_collection_name=<span class="literal">None</span>,</span><br><span class="line">        dimension=<span class="number">10</span>,</span><br><span class="line">        combiner=<span class="string">&quot;mean&quot;</span>,</span><br><span class="line">        initializer=tf.initializers.glorot_normal,</span><br><span class="line">        ckpt_to_load_from=<span class="literal">None</span>,</span><br><span class="line">        tensor_name_in_ckpt=<span class="literal">None</span>,</span><br><span class="line">        max_norm=<span class="literal">None</span>,</span><br><span class="line">        trainable=<span class="literal">True</span>)</span><br><span class="line">    shared_column1, shared_column2 = columns</span><br><span class="line">    <span class="keyword">return</span> shared_column1, shared_column2</span><br></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://www.ritchie.top/2020/01/22/tensorflow2-feature-column/" data-id="ck71dq498000rdcz6knrmmv8v" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACNUlEQVR42u3aS27CQBAFQO5/abKNRDDv9ZhIHtesUHCwi0XTv8cjPs9fp/3767uvVx5/2mkHAwPjsozn4Xl3g/xBE97x6+Nnw8DAuA8jCYXJR+ePmIfg42swMDAwckYSUttgioGBgbHCyNO+JLAeUzEwMDBmga8oL8vG3NdrcQwMjAsy8jbZ/7/+ynwDAwPjUoxneZI0bn2cWT8VBgbG1oy2WZ+Xu3m7Lb/LhysxMDBuwDgOl3nLLClNZ8tnwz0ODAyMjRjt2DJHzpYzkqWNt78bGBgYmzJmLfh2eDD7hBNGmBgYGBsx2vSxLVPbwrj4ajAwMG7GmAXBFUwybPhQymJgYGzKmAHa9lw+5mybcX9MYjEwMLZjtMlfXnyeVegW7TYMDIwbMNqkbT1xbIej7UAUAwNjD0a7qJq/m7fS8qSw2BbBwMDYiDEbHOaPng9EZ+PStzsjGBgYGzFWUrSkEbayulEcDAyMrRntP88SwXMHpR8GmRgYGJsyVlLAGWk2NhiOBDAwMLZgtGPLtjTN08d2pFossGJgYGzByFcc2mJ4xm5HpxgYGHdgrNxgNgDIF8uKWhwDA2M7xrM8ZxW67RdU5LYYGBjbMc4aduYJXJ5oJq9rDAYGxmUZSZDNx5PtykUecD8EawwMjBsw1gNf27ZbKWLfBlwMDAyML1x/Wg6LgYGBMUoN8+ZaW0KfEHAxMDAuyMgb/W2jrS1Z21EoBgbGHRht3tWmid9Y7BgOMjEwMK7H+AHCMrwqS/g3NAAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/feature-column-embedding-column-FeatureTransformationCache-StateManager/">feature_column embedding_column FeatureTransformationCache StateManager</a></div><div class="post-nav"><a class="pre" href="/2020/02/25/tensorflow2-estimator-titanic/">【Tensorflow2】Estimator使用流程——以Titanic预测任务为例</a><a class="next" href="/2020/01/11/tensorflow2-outline/">【Tensorflow2】从这里开始</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: 'e1d9a23bff9cf37a908f',
  clientSecret: 'e940ee66119d68ddc9e557b57925f146ff8e180f',
  repo: 'ritchietop.github.io',
  owner: 'ritchietop',
  admin: ['ritchietop'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/paper/">paper</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tensorflow/">tensorflow</a><span class="category-list-count">5</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/tensorflow-dataset-pipeline/" style="font-size: 15px;">tensorflow dataset pipeline</a> <a href="/tags/dnn-recommendation/" style="font-size: 15px;">dnn recommendation</a> <a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/tensorflow-tfrecord-sequenceExample/" style="font-size: 15px;">tensorflow tfrecord sequenceExample</a> <a href="/tags/tensorflow-tfrecord-sequenceExample-spark-feature/" style="font-size: 15px;">tensorflow tfrecord sequenceExample spark feature</a> <a href="/tags/estimator-titanic/" style="font-size: 15px;">estimator titanic</a> <a href="/tags/feature-column-embedding-column-FeatureTransformationCache-StateManager/" style="font-size: 15px;">feature_column embedding_column FeatureTransformationCache StateManager</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/02/25/tensorflow2-estimator-titanic/">【Tensorflow2】Estimator使用流程——以Titanic预测任务为例</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/22/tensorflow2-feature-column/">【Tensorflow2】FeatureColumn简明教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/11/tensorflow2-outline/">【Tensorflow2】从这里开始</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/28/tensorflow-dataset/">【Tensorflow2】Dataset简明教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/25/tensorflow-tfrecord-process/">【Tensorflow2】TFRecord数据读写</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/24/tensorflow-tfrecord-basic_datastruct/">【Tensorflow2】TFRecord数据结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/15/paper-reading-youtube-dnn-recommendation/">【论文小品】Deep neural networks for YouTube recommendations</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/08/simple-markdown-syntax/">简明Markdown语法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://tf.wiki/" title="简单粗暴 TensorFlow 2.0" target="_blank">简单粗暴 TensorFlow 2.0</a><ul></ul><a href="https://keras.io/zh/" title="Keras: 基于 Python 的深度学习库" target="_blank">Keras: 基于 Python 的深度学习库</a><ul></ul><a href="https://leetcode-cn.com/" title="力扣（LeetCode）" target="_blank">力扣（LeetCode）</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Ritchie's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>